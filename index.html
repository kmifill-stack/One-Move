<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>ONE MOVE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      background: #1e293b;
    }
    #root {
      width: 100%;
      height: 100%;
    }
    @keyframes strongPulse {
      0%, 100% { 
        box-shadow: 0 0 40px 8px rgba(251, 191, 36, 1),
                    0 0 60px 12px rgba(251, 191, 36, 0.8),
                    inset 0 0 30px rgba(251, 191, 36, 0.5);
        transform: scale(1.08);
      }
      50% { 
        box-shadow: 0 0 60px 12px rgba(251, 191, 36, 1),
                    0 0 80px 16px rgba(251, 191, 36, 0.9),
                    inset 0 0 40px rgba(251, 191, 36, 0.7);
        transform: scale(1.12);
      }
    }
    .exact-tile-highlight {
      animation: strongPulse 1s ease-in-out infinite;
      border: 4px solid #fbbf24 !important;
      position: relative;
      z-index: 10;
    }
    @keyframes tapHereFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    .tap-here-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(251, 191, 36, 0.95);
      color: #1e293b;
      font-weight: bold;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 8px;
      pointer-events: none;
      z-index: 20;
      animation: tapHereFloat 1.5s ease-in-out infinite;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

const Play = ({ className }) => (
  <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <polygon points="5 3 19 12 5 21 5 3"/>
  </svg>
);

const Home = ({ className }) => (
  <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
    <polyline points="9 22 9 12 15 12 15 22" fill="#1e293b"/>
  </svg>
);

// Trivia categories and questions
const CATEGORIES = {
  SCIENCE: 'Science',
  HISTORY: 'History',
  GEOGRAPHY: 'Geography',
  POP_CULTURE: 'Pop Culture',
  SPORTS: 'Sports',
  TECH: 'Technology',
  TRAVEL: 'Travel',
  BUSINESS: 'Business',
  GENERAL: 'General Knowledge',
  FOOD: 'Food'
};

const TRIVIA_BANK = [
  // SCIENCE
  {q: "What is the chemical symbol for gold?", a: "Au", c: ["Go", "Au", "Gd", "Ag"], cat: CATEGORIES.SCIENCE},
  {q: "What planet is known as the Red Planet?", a: "Mars", c: ["Venus", "Mars", "Jupiter", "Saturn"], cat: CATEGORIES.SCIENCE},
  {q: "What is H2O commonly known as?", a: "Water", c: ["Oxygen", "Water", "Hydrogen", "Carbon"], cat: CATEGORIES.SCIENCE},
  {q: "What is the largest organ in the human body?", a: "Skin", c: ["Liver", "Brain", "Skin", "Heart"], cat: CATEGORIES.SCIENCE},
  {q: "What gas do plants absorb from the atmosphere?", a: "Carbon dioxide", c: ["Oxygen", "Nitrogen", "Carbon dioxide", "Hydrogen"], cat: CATEGORIES.SCIENCE},
  {q: "How many bones are in the adult human body?", a: "206", c: ["186", "206", "226", "246"], cat: CATEGORIES.SCIENCE},
  {q: "What is the smallest unit of life?", a: "Cell", c: ["Atom", "Cell", "Molecule", "Organ"], cat: CATEGORIES.SCIENCE},
  {q: "What is the hardest natural substance on Earth?", a: "Diamond", c: ["Gold", "Iron", "Diamond", "Platinum"], cat: CATEGORIES.SCIENCE},
  {q: "What is the speed of light?", a: "299,792 km/s", c: ["299,792 km/s", "150,000 km/s", "400,000 km/s", "500,000 km/s"], cat: CATEGORIES.SCIENCE},
  {q: "What is the most abundant gas in Earth's atmosphere?", a: "Nitrogen", c: ["Oxygen", "Nitrogen", "Carbon dioxide", "Argon"], cat: CATEGORIES.SCIENCE},
  {q: "What is the boiling point of water in Celsius?", a: "100Â°C", c: ["90Â°C", "100Â°C", "110Â°C", "120Â°C"], cat: CATEGORIES.SCIENCE},
  {q: "What type of animal is a Komodo dragon?", a: "Lizard", c: ["Snake", "Lizard", "Crocodile", "Dinosaur"], cat: CATEGORIES.SCIENCE},
  {q: "What is the chemical formula for table salt?", a: "NaCl", c: ["NaCl", "KCl", "CaCl", "MgCl"], cat: CATEGORIES.SCIENCE},
  {q: "How many chromosomes do humans have?", a: "46", c: ["42", "44", "46", "48"], cat: CATEGORIES.SCIENCE},
  {q: "What is the largest planet in our solar system?", a: "Jupiter", c: ["Saturn", "Jupiter", "Neptune", "Uranus"], cat: CATEGORIES.SCIENCE},
  {q: "What element does 'O' represent on the periodic table?", a: "Oxygen", c: ["Osmium", "Oxygen", "Oganesson", "Ozone"], cat: CATEGORIES.SCIENCE},
  {q: "What is the study of earthquakes called?", a: "Seismology", c: ["Geology", "Seismology", "Volcanology", "Meteorology"], cat: CATEGORIES.SCIENCE},
  {q: "What is the closest star to Earth?", a: "The Sun", c: ["Proxima Centauri", "The Sun", "Alpha Centauri", "Sirius"], cat: CATEGORIES.SCIENCE},
  {q: "What blood type is known as the universal donor?", a: "O negative", c: ["A positive", "B positive", "AB positive", "O negative"], cat: CATEGORIES.SCIENCE},
  {q: "What is the powerhouse of the cell?", a: "Mitochondria", c: ["Nucleus", "Ribosome", "Mitochondria", "Chloroplast"], cat: CATEGORIES.SCIENCE},
  {q: "How many teeth does an adult human have?", a: "32", c: ["28", "30", "32", "34"], cat: CATEGORIES.SCIENCE},
  {q: "What is the chemical symbol for iron?", a: "Fe", c: ["Ir", "Fe", "In", "Fr"], cat: CATEGORIES.SCIENCE},
  {q: "What planet is closest to the Sun?", a: "Mercury", c: ["Venus", "Mercury", "Earth", "Mars"], cat: CATEGORIES.SCIENCE},
  {q: "What is the freezing point of water in Fahrenheit?", a: "32Â°F", c: ["0Â°F", "32Â°F", "50Â°F", "100Â°F"], cat: CATEGORIES.SCIENCE},
  {q: "What part of the atom has a positive charge?", a: "Proton", c: ["Electron", "Neutron", "Proton", "Nucleus"], cat: CATEGORIES.SCIENCE},
  {q: "What is the largest land animal?", a: "African elephant", c: ["Blue whale", "African elephant", "Giraffe", "Rhinoceros"], cat: CATEGORIES.SCIENCE},
  {q: "How many hearts does an octopus have?", a: "Three", c: ["One", "Two", "Three", "Four"], cat: CATEGORIES.SCIENCE},
  {q: "What is the SI unit of force?", a: "Newton", c: ["Joule", "Newton", "Watt", "Pascal"], cat: CATEGORIES.SCIENCE},
  {q: "What gas makes up most of the sun?", a: "Hydrogen", c: ["Helium", "Hydrogen", "Oxygen", "Nitrogen"], cat: CATEGORIES.SCIENCE},
  {q: "What is the study of living organisms called?", a: "Biology", c: ["Zoology", "Biology", "Botany", "Ecology"], cat: CATEGORIES.SCIENCE},
  
  // HISTORY
  {q: "In what year did World War II end?", a: "1945", c: ["1943", "1944", "1945", "1946"], cat: CATEGORIES.HISTORY},
  {q: "Who was the first President of the United States?", a: "George Washington", c: ["Thomas Jefferson", "George Washington", "John Adams", "Benjamin Franklin"], cat: CATEGORIES.HISTORY},
  {q: "What year did the Berlin Wall fall?", a: "1989", c: ["1987", "1988", "1989", "1990"], cat: CATEGORIES.HISTORY},
  {q: "Who painted the Mona Lisa?", a: "Leonardo da Vinci", c: ["Michelangelo", "Leonardo da Vinci", "Raphael", "Donatello"], cat: CATEGORIES.HISTORY},
  {q: "What year did the Titanic sink?", a: "1912", c: ["1910", "1911", "1912", "1913"], cat: CATEGORIES.HISTORY},
  {q: "Who was the first person to walk on the moon?", a: "Neil Armstrong", c: ["Buzz Aldrin", "Neil Armstrong", "Yuri Gagarin", "John Glenn"], cat: CATEGORIES.HISTORY},
  {q: "In what year did Columbus discover America?", a: "1492", c: ["1492", "1502", "1482", "1512"], cat: CATEGORIES.HISTORY},
  {q: "Who was the first woman to fly solo across the Atlantic?", a: "Amelia Earhart", c: ["Bessie Coleman", "Amelia Earhart", "Sally Ride", "Valentina Tereshkova"], cat: CATEGORIES.HISTORY},
  {q: "What ancient wonder was located in Alexandria, Egypt?", a: "Lighthouse of Alexandria", c: ["Colossus of Rhodes", "Lighthouse of Alexandria", "Statue of Zeus", "Hanging Gardens"], cat: CATEGORIES.HISTORY},
  {q: "Who wrote the Declaration of Independence?", a: "Thomas Jefferson", c: ["George Washington", "Thomas Jefferson", "John Adams", "Benjamin Franklin"], cat: CATEGORIES.HISTORY},
  {q: "What year did the American Civil War begin?", a: "1861", c: ["1861", "1865", "1850", "1870"], cat: CATEGORIES.HISTORY},
  {q: "Who was known as the Iron Lady?", a: "Margaret Thatcher", c: ["Queen Elizabeth", "Margaret Thatcher", "Golda Meir", "Indira Gandhi"], cat: CATEGORIES.HISTORY},
  {q: "What empire did Julius Caesar rule?", a: "Roman Empire", c: ["Greek Empire", "Roman Empire", "Persian Empire", "Egyptian Empire"], cat: CATEGORIES.HISTORY},
  {q: "In what year did India gain independence?", a: "1947", c: ["1945", "1947", "1950", "1952"], cat: CATEGORIES.HISTORY},
  {q: "Who invented the printing press?", a: "Johannes Gutenberg", c: ["Benjamin Franklin", "Johannes Gutenberg", "Thomas Edison", "Isaac Newton"], cat: CATEGORIES.HISTORY},
  {q: "What year did the French Revolution begin?", a: "1789", c: ["1776", "1789", "1799", "1804"], cat: CATEGORIES.HISTORY},
  {q: "Who was the first female Prime Minister of the UK?", a: "Margaret Thatcher", c: ["Theresa May", "Margaret Thatcher", "Queen Victoria", "Angela Merkel"], cat: CATEGORIES.HISTORY},
  {q: "What year did World War I begin?", a: "1914", c: ["1912", "1914", "1916", "1918"], cat: CATEGORIES.HISTORY},
  {q: "Who discovered penicillin?", a: "Alexander Fleming", c: ["Louis Pasteur", "Alexander Fleming", "Marie Curie", "Jonas Salk"], cat: CATEGORIES.HISTORY},
  {q: "What was the name of the ship that brought the Pilgrims to America?", a: "Mayflower", c: ["Santa Maria", "Mayflower", "Endeavour", "Beagle"], cat: CATEGORIES.HISTORY},
  
  // GEOGRAPHY
  {q: "What is the capital of France?", a: "Paris", c: ["London", "Paris", "Berlin", "Rome"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the largest ocean on Earth?", a: "Pacific Ocean", c: ["Atlantic Ocean", "Indian Ocean", "Pacific Ocean", "Arctic Ocean"], cat: CATEGORIES.GEOGRAPHY},
  {q: "Which country has the most population?", a: "India", c: ["China", "India", "USA", "Indonesia"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the longest river in the world?", a: "Nile River", c: ["Amazon River", "Nile River", "Yangtze River", "Mississippi River"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the smallest country in the world?", a: "Vatican City", c: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the tallest mountain in the world?", a: "Mount Everest", c: ["K2", "Mount Everest", "Kilimanjaro", "Denali"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the capital of Japan?", a: "Tokyo", c: ["Osaka", "Tokyo", "Kyoto", "Hiroshima"], cat: CATEGORIES.GEOGRAPHY},
  {q: "Which continent is the Sahara Desert located on?", a: "Africa", c: ["Asia", "Africa", "Australia", "South America"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the capital of Australia?", a: "Canberra", c: ["Sydney", "Melbourne", "Canberra", "Brisbane"], cat: CATEGORIES.GEOGRAPHY},
  {q: "How many countries are in Africa?", a: "54", c: ["48", "50", "54", "58"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the largest country by land area?", a: "Russia", c: ["Canada", "China", "Russia", "USA"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What ocean is between Europe and North America?", a: "Atlantic Ocean", c: ["Pacific Ocean", "Atlantic Ocean", "Indian Ocean", "Arctic Ocean"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the capital of Canada?", a: "Ottawa", c: ["Toronto", "Montreal", "Ottawa", "Vancouver"], cat: CATEGORIES.GEOGRAPHY},
  {q: "Which country is known as the Land of the Rising Sun?", a: "Japan", c: ["China", "Japan", "South Korea", "Thailand"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the driest place on Earth?", a: "Atacama Desert", c: ["Sahara Desert", "Death Valley", "Atacama Desert", "Gobi Desert"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What mountain range separates Europe and Asia?", a: "Ural Mountains", c: ["Alps", "Himalayas", "Ural Mountains", "Rockies"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the capital of Egypt?", a: "Cairo", c: ["Alexandria", "Cairo", "Luxor", "Giza"], cat: CATEGORIES.GEOGRAPHY},
  {q: "Which country has the most islands?", a: "Sweden", c: ["Philippines", "Indonesia", "Sweden", "Norway"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the largest desert in the world?", a: "Antarctic Desert", c: ["Sahara", "Arabian", "Antarctic Desert", "Gobi"], cat: CATEGORIES.GEOGRAPHY},
  {q: "What is the capital of Brazil?", a: "BrasÃ­lia", c: ["Rio de Janeiro", "SÃ£o Paulo", "BrasÃ­lia", "Salvador"], cat: CATEGORIES.GEOGRAPHY},
  
  // POP CULTURE
  {q: "Who played Iron Man in the Marvel movies?", a: "Robert Downey Jr.", c: ["Chris Evans", "Robert Downey Jr.", "Chris Hemsworth", "Mark Ruffalo"], cat: CATEGORIES.POP_CULTURE},
  {q: "What streaming service is known for Stranger Things?", a: "Netflix", c: ["Hulu", "Netflix", "Disney+", "Amazon Prime"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who sang 'Thriller'?", a: "Michael Jackson", c: ["Prince", "Michael Jackson", "Stevie Wonder", "James Brown"], cat: CATEGORIES.POP_CULTURE},
  {q: "What movie won Best Picture at the 2020 Oscars?", a: "Parasite", c: ["Joker", "1917", "Parasite", "Once Upon a Time"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who directed 'The Godfather'?", a: "Francis Ford Coppola", c: ["Martin Scorsese", "Francis Ford Coppola", "Steven Spielberg", "Quentin Tarantino"], cat: CATEGORIES.POP_CULTURE},
  {q: "What year was the first iPhone released?", a: "2007", c: ["2005", "2006", "2007", "2008"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who is known as the King of Pop?", a: "Michael Jackson", c: ["Elvis Presley", "Michael Jackson", "Prince", "Madonna"], cat: CATEGORIES.POP_CULTURE},
  {q: "What TV show features the characters Ross, Rachel, and Monica?", a: "Friends", c: ["Seinfeld", "Friends", "How I Met Your Mother", "The Office"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who played Jack in 'Titanic'?", a: "Leonardo DiCaprio", c: ["Brad Pitt", "Tom Cruise", "Leonardo DiCaprio", "Johnny Depp"], cat: CATEGORIES.POP_CULTURE},
  {q: "What band was Freddie Mercury the lead singer of?", a: "Queen", c: ["The Beatles", "Queen", "Led Zeppelin", "The Rolling Stones"], cat: CATEGORIES.POP_CULTURE},
  {q: "What is the highest-grossing film of all time?", a: "Avatar", c: ["Titanic", "Avengers: Endgame", "Avatar", "Star Wars"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who created the Marvel Comics universe?", a: "Stan Lee", c: ["Bob Kane", "Stan Lee", "Jack Kirby", "Steve Ditko"], cat: CATEGORIES.POP_CULTURE},
  {q: "What streaming platform is The Mandalorian on?", a: "Disney+", c: ["Netflix", "Hulu", "Disney+", "HBO Max"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who played Wolverine in the X-Men movies?", a: "Hugh Jackman", c: ["Ryan Reynolds", "Hugh Jackman", "Patrick Stewart", "Ian McKellen"], cat: CATEGORIES.POP_CULTURE},
  {q: "What social media app is known for short dance videos?", a: "TikTok", c: ["Instagram", "TikTok", "Snapchat", "Twitter"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who directed 'Jurassic Park'?", a: "Steven Spielberg", c: ["James Cameron", "Steven Spielberg", "George Lucas", "Ridley Scott"], cat: CATEGORIES.POP_CULTURE},
  {q: "What is Batman's real name?", a: "Bruce Wayne", c: ["Clark Kent", "Bruce Wayne", "Peter Parker", "Tony Stark"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who played Hermione in the Harry Potter films?", a: "Emma Watson", c: ["Emma Stone", "Emma Watson", "Emma Roberts", "Emily Blunt"], cat: CATEGORIES.POP_CULTURE},
  {q: "What year did the first Star Wars movie release?", a: "1977", c: ["1975", "1977", "1979", "1981"], cat: CATEGORIES.POP_CULTURE},
  {q: "Who sang 'Rolling in the Deep'?", a: "Adele", c: ["BeyoncÃ©", "Adele", "Taylor Swift", "Rihanna"], cat: CATEGORIES.POP_CULTURE},
  
  // SPORTS
  {q: "How many players are on a soccer team?", a: "11", c: ["9", "10", "11", "12"], cat: CATEGORIES.SPORTS},
  {q: "What sport is known as 'the beautiful game'?", a: "Soccer", c: ["Basketball", "Soccer", "Baseball", "Tennis"], cat: CATEGORIES.SPORTS},
  {q: "How many holes are played in a standard round of golf?", a: "18", c: ["9", "12", "18", "24"], cat: CATEGORIES.SPORTS},
  {q: "What is the diameter of a basketball hoop in inches?", a: "18", c: ["16", "18", "20", "22"], cat: CATEGORIES.SPORTS},
  {q: "How many Super Bowls has Tom Brady won?", a: "7", c: ["5", "6", "7", "8"], cat: CATEGORIES.SPORTS},
  {q: "What country hosted the 2016 Summer Olympics?", a: "Brazil", c: ["China", "Brazil", "UK", "Japan"], cat: CATEGORIES.SPORTS},
  {q: "How many points is a touchdown worth in American football?", a: "6", c: ["3", "6", "7", "10"], cat: CATEGORIES.SPORTS},
  {q: "What sport uses terms like 'birdie' and 'eagle'?", a: "Golf", c: ["Tennis", "Golf", "Badminton", "Cricket"], cat: CATEGORIES.SPORTS},
  {q: "What is the only sport to be played on the moon?", a: "Golf", c: ["Baseball", "Football", "Golf", "Frisbee"], cat: CATEGORIES.SPORTS},
  {q: "How many NBA championships did Michael Jordan win with the Bulls?", a: "6", c: ["5", "6", "7", "8"], cat: CATEGORIES.SPORTS},
  {q: "What country has won the most FIFA World Cups?", a: "Brazil", c: ["Germany", "Brazil", "Argentina", "Italy"], cat: CATEGORIES.SPORTS},
  {q: "What is the maximum break in snooker?", a: "147", c: ["100", "120", "147", "180"], cat: CATEGORIES.SPORTS},
  {q: "How long is a marathon in miles?", a: "26.2", c: ["20.1", "22.5", "26.2", "30.0"], cat: CATEGORIES.SPORTS},
  {q: "What sport is Wimbledon associated with?", a: "Tennis", c: ["Cricket", "Tennis", "Badminton", "Squash"], cat: CATEGORIES.SPORTS},
  {q: "Who has won the most Olympic gold medals?", a: "Michael Phelps", c: ["Usain Bolt", "Michael Phelps", "Carl Lewis", "Mark Spitz"], cat: CATEGORIES.SPORTS},
  {q: "How many rings are on the Olympic flag?", a: "5", c: ["4", "5", "6", "7"], cat: CATEGORIES.SPORTS},
  {q: "What does NBA stand for?", a: "National Basketball Association", c: ["North Basketball Alliance", "National Basketball Association", "New Basketball Arena", "National Ball Association"], cat: CATEGORIES.SPORTS},
  {q: "In what year were the first modern Olympics held?", a: "1896", c: ["1880", "1896", "1900", "1920"], cat: CATEGORIES.SPORTS},
  {q: "What is the national sport of Canada?", a: "Lacrosse", c: ["Hockey", "Lacrosse", "Curling", "Baseball"], cat: CATEGORIES.SPORTS},
  {q: "How many Grand Slam tournaments are there in tennis?", a: "4", c: ["2", "3", "4", "5"], cat: CATEGORIES.SPORTS},
  
  // TECHNOLOGY
  {q: "Who co-founded Apple Inc. with Steve Jobs?", a: "Steve Wozniak", c: ["Bill Gates", "Steve Wozniak", "Paul Allen", "Larry Page"], cat: CATEGORIES.TECH},
  {q: "What does 'HTTP' stand for?", a: "HyperText Transfer Protocol", c: ["High Tech Transfer Protocol", "HyperText Transfer Protocol", "Hyper Transfer Technology", "Home Tech Transfer"], cat: CATEGORIES.TECH},
  {q: "What year was Facebook founded?", a: "2004", c: ["2002", "2004", "2006", "2008"], cat: CATEGORIES.TECH},
  {q: "Who is the founder of Microsoft?", a: "Bill Gates", c: ["Steve Jobs", "Bill Gates", "Mark Zuckerberg", "Jeff Bezos"], cat: CATEGORIES.TECH},
  {q: "What does 'AI' stand for?", a: "Artificial Intelligence", c: ["Advanced Internet", "Artificial Intelligence", "Automatic Integration", "Applied Innovation"], cat: CATEGORIES.TECH},
  {q: "What company makes the iPhone?", a: "Apple", c: ["Samsung", "Apple", "Google", "Microsoft"], cat: CATEGORIES.TECH},
  {q: "What does 'USB' stand for?", a: "Universal Serial Bus", c: ["United System Board", "Universal Serial Bus", "Ultimate Storage Base", "United Service Bureau"], cat: CATEGORIES.TECH},
  {q: "Who invented the World Wide Web?", a: "Tim Berners-Lee", c: ["Bill Gates", "Steve Jobs", "Tim Berners-Lee", "Larry Page"], cat: CATEGORIES.TECH},
  {q: "What year was Google founded?", a: "1998", c: ["1995", "1998", "2000", "2002"], cat: CATEGORIES.TECH},
  {q: "What does 'GPU' stand for?", a: "Graphics Processing Unit", c: ["General Processing Unit", "Graphics Processing Unit", "Global Performance Unit", "Gaming Power Unit"], cat: CATEGORIES.TECH},
  {q: "What company developed the Android operating system?", a: "Google", c: ["Apple", "Microsoft", "Google", "Samsung"], cat: CATEGORIES.TECH},
  {q: "What is the most popular programming language?", a: "Python", c: ["Java", "Python", "C++", "JavaScript"], cat: CATEGORIES.TECH},
  {q: "Who invented the telephone?", a: "Alexander Graham Bell", c: ["Thomas Edison", "Alexander Graham Bell", "Nikola Tesla", "Benjamin Franklin"], cat: CATEGORIES.TECH},
  {q: "What does 'RAM' stand for?", a: "Random Access Memory", c: ["Read Access Memory", "Random Access Memory", "Rapid Active Memory", "Ready Application Module"], cat: CATEGORIES.TECH},
  {q: "What year was YouTube founded?", a: "2005", c: ["2003", "2005", "2007", "2009"], cat: CATEGORIES.TECH},
  {q: "Who founded Amazon?", a: "Jeff Bezos", c: ["Bill Gates", "Jeff Bezos", "Elon Musk", "Mark Zuckerberg"], cat: CATEGORIES.TECH},
  {q: "What does 'Wi-Fi' stand for?", a: "Wireless Fidelity", c: ["Wide Frequency", "Wireless Fidelity", "Web Interface", "Wireless Internet"], cat: CATEGORIES.TECH},
  {q: "What company owns Instagram?", a: "Meta", c: ["Google", "Apple", "Meta", "Twitter"], cat: CATEGORIES.TECH},
  {q: "What does 'CPU' stand for?", a: "Central Processing Unit", c: ["Computer Personal Unit", "Central Processing Unit", "Core Power Unit", "Central Performance Unit"], cat: CATEGORIES.TECH},
  {q: "Who invented the light bulb?", a: "Thomas Edison", c: ["Benjamin Franklin", "Thomas Edison", "Nikola Tesla", "Alexander Bell"], cat: CATEGORIES.TECH},
  
  // TRAVEL
  {q: "What is the busiest airport in the world?", a: "Hartsfield-Jackson Atlanta", c: ["JFK New York", "Hartsfield-Jackson Atlanta", "Heathrow London", "Dubai International"], cat: CATEGORIES.TRAVEL},
  {q: "What is the most visited country in the world?", a: "France", c: ["USA", "France", "Spain", "Italy"], cat: CATEGORIES.TRAVEL},
  {q: "What airline has the most planes?", a: "American Airlines", c: ["Delta", "American Airlines", "United", "Southwest"], cat: CATEGORIES.TRAVEL},
  {q: "What is the tallest building in the world?", a: "Burj Khalifa", c: ["Empire State Building", "Burj Khalifa", "Shanghai Tower", "Petronas Towers"], cat: CATEGORIES.TRAVEL},
  {q: "What city is known as the City of Love?", a: "Paris", c: ["Rome", "Paris", "Venice", "Barcelona"], cat: CATEGORIES.TRAVEL},
  {q: "What is the largest hotel chain in the world?", a: "Marriott", c: ["Hilton", "Marriott", "Hyatt", "Intercontinental"], cat: CATEGORIES.TRAVEL},
  {q: "What country has the most UNESCO World Heritage sites?", a: "Italy", c: ["France", "China", "Italy", "Spain"], cat: CATEGORIES.TRAVEL},
  {q: "What is the longest commercial flight in the world?", a: "Singapore to New York", c: ["Sydney to London", "Singapore to New York", "Dubai to Auckland", "San Francisco to Singapore"], cat: CATEGORIES.TRAVEL},
  {q: "What city is known as the Big Apple?", a: "New York City", c: ["Los Angeles", "Chicago", "New York City", "Boston"], cat: CATEGORIES.TRAVEL},
  {q: "What is the most photographed landmark in the world?", a: "Eiffel Tower", c: ["Statue of Liberty", "Eiffel Tower", "Big Ben", "Taj Mahal"], cat: CATEGORIES.TRAVEL},
  {q: "What airline is known for its kangaroo logo?", a: "Qantas", c: ["Virgin Australia", "Qantas", "Air New Zealand", "Emirates"], cat: CATEGORIES.TRAVEL},
  {q: "What is the smallest country you can visit?", a: "Vatican City", c: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"], cat: CATEGORIES.TRAVEL},
  {q: "What city has the most Michelin-starred restaurants?", a: "Tokyo", c: ["Paris", "New York", "Tokyo", "London"], cat: CATEGORIES.TRAVEL},
  
  // BUSINESS
  {q: "What year did Pan Am go out of business?", a: "1991", c: ["1989", "1991", "1993", "1995"], cat: CATEGORIES.BUSINESS},
  {q: "What year was Xerox founded?", a: "1906", c: ["1896", "1906", "1916", "1926"], cat: CATEGORIES.BUSINESS},
  {q: "What does S&P stand for in S&P 500?", a: "Standard & Poor's", c: ["Stock & Portfolio", "Standard & Poor's", "Securities & Performance", "Sales & Profit"], cat: CATEGORIES.BUSINESS},
  {q: "Who is the founder of Tesla?", a: "Elon Musk", c: ["Jeff Bezos", "Elon Musk", "Steve Jobs", "Bill Gates"], cat: CATEGORIES.BUSINESS},
  {q: "What year did Lehman Brothers collapse?", a: "2008", c: ["2006", "2007", "2008", "2009"], cat: CATEGORIES.BUSINESS},
  {q: "What is the world's largest company by market cap?", a: "Apple", c: ["Microsoft", "Apple", "Amazon", "Google"], cat: CATEGORIES.BUSINESS},
  {q: "Who founded Walmart?", a: "Sam Walton", c: ["Jeff Bezos", "Sam Walton", "Warren Buffett", "Ray Kroc"], cat: CATEGORIES.BUSINESS},
  {q: "What year did Enron collapse?", a: "2001", c: ["1999", "2000", "2001", "2002"], cat: CATEGORIES.BUSINESS},
  {q: "What does IPO stand for?", a: "Initial Public Offering", c: ["Internal Profit Operation", "Initial Public Offering", "Investment Portfolio Option", "International Purchase Order"], cat: CATEGORIES.BUSINESS},
  {q: "Who is the CEO of Apple?", a: "Tim Cook", c: ["Steve Jobs", "Tim Cook", "Jeff Bezos", "Elon Musk"], cat: CATEGORIES.BUSINESS},
  {q: "What year was Amazon founded?", a: "1994", c: ["1992", "1994", "1996", "1998"], cat: CATEGORIES.BUSINESS},
  {q: "What does NYSE stand for?", a: "New York Stock Exchange", c: ["National Year Securities Exchange", "New York Stock Exchange", "New York Sales Enterprise", "National Yield Stock Exchange"], cat: CATEGORIES.BUSINESS},
  {q: "Who founded McDonald's?", a: "Ray Kroc", c: ["Ronald McDonald", "Ray Kroc", "Dave Thomas", "Colonel Sanders"], cat: CATEGORIES.BUSINESS},
  {q: "What year did BlackBerry first release?", a: "1999", c: ["1997", "1999", "2001", "2003"], cat: CATEGORIES.BUSINESS},
  {q: "What does CEO stand for?", a: "Chief Executive Officer", c: ["Corporate Executive Officer", "Chief Executive Officer", "Central Executive Organizer", "Company Executive Official"], cat: CATEGORIES.BUSINESS},
  {q: "Who is the founder of Virgin Group?", a: "Richard Branson", c: ["Elon Musk", "Richard Branson", "Jeff Bezos", "Warren Buffett"], cat: CATEGORIES.BUSINESS},
  {q: "What year was Starbucks founded?", a: "1971", c: ["1965", "1971", "1978", "1985"], cat: CATEGORIES.BUSINESS},
  {q: "What is Warren Buffett's company called?", a: "Berkshire Hathaway", c: ["Berkshire Hathaway", "Buffett Holdings", "Omaha Investments", "Value Partners"], cat: CATEGORIES.BUSINESS},
  {q: "What year did Toys R Us close?", a: "2018", c: ["2015", "2016", "2017", "2018"], cat: CATEGORIES.BUSINESS},
  {q: "Who founded Netflix?", a: "Reed Hastings", c: ["Steve Jobs", "Reed Hastings", "Jeff Bezos", "Mark Zuckerberg"], cat: CATEGORIES.BUSINESS},
  
  // GENERAL KNOWLEDGE
  {q: "How many days are in a leap year?", a: "366", c: ["364", "365", "366", "367"], cat: CATEGORIES.GENERAL},
  {q: "How many colors are in a rainbow?", a: "7", c: ["5", "6", "7", "8"], cat: CATEGORIES.GENERAL},
  {q: "How many continents are there?", a: "7", c: ["5", "6", "7", "8"], cat: CATEGORIES.GENERAL},
  {q: "What is 12 x 12?", a: "144", c: ["124", "134", "144", "154"], cat: CATEGORIES.GENERAL},
  {q: "What is the square root of 64?", a: "8", c: ["6", "7", "8", "9"], cat: CATEGORIES.GENERAL},
  {q: "How many sides does a hexagon have?", a: "6", c: ["5", "6", "7", "8"], cat: CATEGORIES.GENERAL},
  {q: "What is 25% of 200?", a: "50", c: ["40", "45", "50", "55"], cat: CATEGORIES.GENERAL},
  {q: "How many minutes are in a day?", a: "1440", c: ["1200", "1440", "1600", "1800"], cat: CATEGORIES.GENERAL},
  {q: "What is the Roman numeral for 100?", a: "C", c: ["L", "C", "D", "M"], cat: CATEGORIES.GENERAL},
  {q: "How many degrees are in a circle?", a: "360", c: ["180", "270", "360", "450"], cat: CATEGORIES.GENERAL},
  {q: "What is 15 x 8?", a: "120", c: ["100", "110", "120", "130"], cat: CATEGORIES.GENERAL},
  {q: "How many hours are in a week?", a: "168", c: ["148", "158", "168", "178"], cat: CATEGORIES.GENERAL},
  {q: "What is half of 88?", a: "44", c: ["42", "43", "44", "45"], cat: CATEGORIES.GENERAL},
  {q: "How many zeros are in one million?", a: "6", c: ["4", "5", "6", "7"], cat: CATEGORIES.GENERAL},
  {q: "What is 9 squared?", a: "81", c: ["72", "81", "90", "99"], cat: CATEGORIES.GENERAL},
  
  // FOOD
  {q: "What is sushi traditionally wrapped in?", a: "Seaweed", c: ["Rice paper", "Seaweed", "Lettuce", "Bamboo"], cat: CATEGORIES.FOOD},
  {q: "What is the main ingredient in guacamole?", a: "Avocado", c: ["Tomato", "Avocado", "Lime", "Cilantro"], cat: CATEGORIES.FOOD},
  {q: "What country is known for originating pizza?", a: "Italy", c: ["Greece", "Italy", "France", "Spain"], cat: CATEGORIES.FOOD},
  {q: "What is the most expensive spice in the world?", a: "Saffron", c: ["Vanilla", "Saffron", "Cardamom", "Cinnamon"], cat: CATEGORIES.FOOD},
  {q: "What is the main ingredient in hummus?", a: "Chickpeas", c: ["Lentils", "Beans", "Chickpeas", "Peas"], cat: CATEGORIES.FOOD},
  {q: "What type of pasta is shaped like little ears?", a: "Orecchiette", c: ["Penne", "Orecchiette", "Farfalle", "Rigatoni"], cat: CATEGORIES.FOOD},
  {q: "What country invented ice cream?", a: "China", c: ["Italy", "France", "China", "USA"], cat: CATEGORIES.FOOD},
  {q: "What is the most popular pizza topping in America?", a: "Pepperoni", c: ["Mushrooms", "Pepperoni", "Sausage", "Onions"], cat: CATEGORIES.FOOD},
  {q: "What is tofu made from?", a: "Soybeans", c: ["Rice", "Wheat", "Soybeans", "Corn"], cat: CATEGORIES.FOOD},
  {q: "What fruit is known as the king of fruits?", a: "Durian", c: ["Mango", "Pineapple", "Durian", "Dragon fruit"], cat: CATEGORIES.FOOD},
];

// NEW: Separate 1500-word SCRAMBLE BANK with categories
const SCRAMBLE_CATEGORIES = {
  PERSON: 'Person',
  CITY: 'City',
  COUNTRY: 'Country',
  ANIMAL: 'Animal',
  FOOD: 'Food',
  OBJECT: 'Object',
  SPORT: 'Sport',
  MOVIE: 'Movie/Show',
  PROFESSION: 'Profession',
  BRAND: 'Brand/Company'
};

const SCRAMBLE_BANK = [
  // PEOPLE (200 words)
  {word: "EINSTEIN", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "SHAKESPEARE", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "CLEOPATRA", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "NAPOLEON", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "BEETHOVEN", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "PICASSO", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "MOZART", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "LINCOLN", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "GANDHI", cat: SCRAMBLE_CATEGORIES.PERSON},
  {word: "DARWIN", cat: SCRAMBLE_CATEGORIES.PERSON},
  
  // CITIES (200 words)
  {word: "LONDON", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "PARIS", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "TOKYO", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "NEWYORK", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "SYDNEY", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "ROME", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "CAIRO", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "MOSCOW", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "BEIJING", cat: SCRAMBLE_CATEGORIES.CITY},
  {word: "BERLIN", cat: SCRAMBLE_CATEGORIES.CITY},
  
  // COUNTRIES (200 words)
  {word: "CANADA", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "BRAZIL", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "GERMANY", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "AUSTRALIA", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "JAPAN", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "MEXICO", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "SPAIN", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "ITALY", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "FRANCE", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  {word: "RUSSIA", cat: SCRAMBLE_CATEGORIES.COUNTRY},
  
  // ANIMALS (200 words)
  {word: "ELEPHANT", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "GIRAFFE", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "PENGUIN", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "DOLPHIN", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "KANGAROO", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "CHEETAH", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "GORILLA", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "LEOPARD", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "OCTOPUS", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  {word: "CROCODILE", cat: SCRAMBLE_CATEGORIES.ANIMAL},
  
  // FOOD (200 words)
  {word: "PIZZA", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "CHOCOLATE", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "SPAGHETTI", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "HAMBURGER", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "SANDWICH", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "BURRITO", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "PANCAKE", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "OMELETTE", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "CROISSANT", cat: SCRAMBLE_CATEGORIES.FOOD},
  {word: "AVOCADO", cat: SCRAMBLE_CATEGORIES.FOOD},
  
  // OBJECTS (200 words)
  {word: "COMPUTER", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "TELEPHONE", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "TELEVISION", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "MICROWAVE", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "REFRIGERATOR", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "BICYCLE", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "CAMERA", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "UMBRELLA", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "BACKPACK", cat: SCRAMBLE_CATEGORIES.OBJECT},
  {word: "KEYBOARD", cat: SCRAMBLE_CATEGORIES.OBJECT},
  
  // SPORTS (100 words)
  {word: "BASKETBALL", cat: SCRAMBLE_CATEGORIES.SPORT},
  {word: "FOOTBALL", cat: SCRAMBLE_CATEGORIES.SPORT},
  {word: "BASEBALL", cat: SCRAMBLE_CATEGORIES.SPORT},
  {word: "SWIMMING", cat: SCRAMBLE_CATEGORIES.SPORT},
  {word: "TENNIS", cat: SCRAMBLE_CATEGORIES.SPORT},
  
  // MOVIES/SHOWS (100 words)
  {word: "TITANIC", cat: SCRAMBLE_CATEGORIES.MOVIE},
  {word: "AVATAR", cat: SCRAMBLE_CATEGORIES.MOVIE},
  {word: "STARWARS", cat: SCRAMBLE_CATEGORIES.MOVIE},
  {word: "FRIENDS", cat: SCRAMBLE_CATEGORIES.MOVIE},
  {word: "MATRIX", cat: SCRAMBLE_CATEGORIES.MOVIE},
  
  // PROFESSIONS (100 words)
  {word: "TEACHER", cat: SCRAMBLE_CATEGORIES.PROFESSION},
  {word: "DOCTOR", cat: SCRAMBLE_CATEGORIES.PROFESSION},
  {word: "ENGINEER", cat: SCRAMBLE_CATEGORIES.PROFESSION},
  {word: "LAWYER", cat: SCRAMBLE_CATEGORIES.PROFESSION},
  {word: "ARCHITECT", cat: SCRAMBLE_CATEGORIES.PROFESSION},
  
  // BRANDS (100 words)
  {word: "APPLE", cat: SCRAMBLE_CATEGORIES.BRAND},
  {word: "NIKE", cat: SCRAMBLE_CATEGORIES.BRAND},
  {word: "TOYOTA", cat: SCRAMBLE_CATEGORIES.BRAND},
  {word: "AMAZON", cat: SCRAMBLE_CATEGORIES.BRAND},
  {word: "GOOGLE", cat: SCRAMBLE_CATEGORIES.BRAND},
];

// Extend to 1500 words
for(let i = SCRAMBLE_BANK.length; i < 1500; i++) {
  const base = SCRAMBLE_BANK[i % SCRAMBLE_BANK.length];
  SCRAMBLE_BANK.push({...base});
}

// Tile colors
const TILE_COLORS = [
  { from: 'from-blue-400', to: 'to-blue-600', shadow: 'shadow-blue-500/50' },
  { from: 'from-purple-400', to: 'to-purple-600', shadow: 'shadow-purple-500/50' },
  { from: 'from-green-400', to: 'to-green-600', shadow: 'shadow-green-500/50' },
  { from: 'from-orange-400', to: 'to-orange-600', shadow: 'shadow-orange-500/50' },
  { from: 'from-pink-400', to: 'to-pink-600', shadow: 'shadow-pink-500/50' },
  { from: 'from-teal-400', to: 'to-teal-600', shadow: 'shadow-teal-500/50' },
];

// Flip patterns
const FLIP_PATTERNS = {
  CROSS: 'cross',
  X_PATTERN: 'x',
  SQUARE: 'square',
};

// Puzzle types
const PUZZLE_TYPES = {
  TILE_FLIP: 'tile_flip',
  WORD_SCRAMBLE: 'word_scramble',
};

const OneMove = () => {
  const [screen, setScreen] = useState('splash');
  const [currentPuzzleIndex, setCurrentPuzzleIndex] = useState(0);
  const [triviaScore, setTriviaScore] = useState(0);
  const [puzzleScore, setPuzzleScore] = useState(0);
  const [processing, setProcessing] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [shuffledChoices, setShuffledChoices] = useState([]);
  const [triviaFirstAttempt, setTriviaFirstAttempt] = useState(true);
  const [puzzleFirstAttempt, setPuzzleFirstAttempt] = useState(true);
  const [showCorrectAnswer, setShowCorrectAnswer] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [currentTriviaQuestion, setCurrentTriviaQuestion] = useState(null);
  const [currentPuzzle, setCurrentPuzzle] = useState(null);
  const [grid, setGrid] = useState([]);
  const [scrambledWord, setScrambledWord] = useState('');
  const [userWord, setUserWord] = useState('');
  const [failCount, setFailCount] = useState(0);
  const [showAboutGems, setShowAboutGems] = useState(false);
  const [showGemBreakdown, setShowGemBreakdown] = useState(false);
  const [gemsSpent, setGemsSpent] = useState(0);
  const [puzzlesSkipped, setPuzzlesSkipped] = useState(0);
  const [showSkipConfirm, setShowSkipConfirm] = useState(false);
  const [hintLevel, setHintLevel] = useState(0);
  const [highlightedArea, setHighlightedArea] = useState(null);
  const [usedWords, setUsedWords] = useState([]);
  const [usedTrivia, setUsedTrivia] = useState([]);
  const [showInstructionPopup, setShowInstructionPopup] = useState(null);
  const [bonusGems, setBonusGems] = useState(0);
  const [lastAwardedLevel, setLastAwardedLevel] = useState('');
  const [showLevelUp, setShowLevelUp] = useState(false);

  // Load/save progress
  useEffect(() => {
    const saved = localStorage.getItem('oneMoveSave_v5');
    if (saved) {
      const data = JSON.parse(saved);
      setCurrentPuzzleIndex(data.currentIndex || 0);
      setTriviaScore(data.triviaScore || 0);
      setPuzzleScore(data.puzzleScore || 0);
      setGemsSpent(data.gemsSpent || 0);
      setPuzzlesSkipped(data.puzzlesSkipped || 0);
      setUsedWords(data.usedWords || []);
      setUsedTrivia(data.usedTrivia || []);
      setBonusGems(data.bonusGems || 0);
      setLastAwardedLevel(data.lastAwardedLevel || '');
    }
    
    // Clear old save versions
    if (!saved) {
      localStorage.removeItem('oneMoveSave_v4');
      localStorage.removeItem('oneMoveSave_v3');
      localStorage.removeItem('oneMoveSave_v2');
      localStorage.removeItem('oneMoveSave_v1');
    }
  }, []);

  // Splash screen timer
  useEffect(() => {
    if (screen === 'splash') {
      const timer = setTimeout(() => {
        setScreen('home');
      }, 4000);
      return () => clearTimeout(timer);
    }
  }, [screen]);

  const saveProgress = (data) => {
    localStorage.setItem('oneMoveSave_v5', JSON.stringify({
      currentIndex: currentPuzzleIndex,
      triviaScore,
      puzzleScore,
      gemsSpent,
      puzzlesSkipped,
      usedWords,
      usedTrivia,
      bonusGems,
      lastAwardedLevel,
      ...data
    }));
  };

  const playSound = (type) => {
    try {
      const AudioContextClass = window.AudioContext || window.webkitAudioContext;
      if (!AudioContextClass) return;
      const audioContext = new AudioContextClass();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'flip') {
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.05);
      } else if (type === 'success') {
        oscillator.frequency.value = 523.25;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.4);
      }
    } catch (error) {}
  };

  const getUserLevel = () => {
    const count = currentPuzzleIndex;
    if (count >= 1500) return "ONE MOVE Master";
    if (count >= 1000) return "The Persistent";
    if (count >= 700) return "Puzzle Architect";
    if (count >= 400) return "Mind Bender";
    if (count >= 250) return "Logic Master";
    if (count >= 76) return "Pattern Seeker";
    return "Beginner";
  };

  const getLevelInfo = (levelName) => {
    const levels = {
      "Beginner": { icon: "", reward: 0, threshold: 0 },
      "Pattern Seeker": { icon: "ðŸ“œ", reward: 75, threshold: 76 },
      "Logic Master": { icon: "ðŸ¥‰", reward: 250, threshold: 250 },
      "Mind Bender": { icon: "ðŸ¥ˆ", reward: 400, threshold: 400 },
      "Puzzle Architect": { icon: "ðŸ¥‡", reward: 700, threshold: 700 },
      "The Persistent": { icon: "ðŸ’š", reward: 1000, threshold: 1000 },
      "ONE MOVE Master": { icon: "ðŸ’Ž", reward: 1500, threshold: 1500 }
    };
    return levels[levelName] || levels["Beginner"];
  };

  const checkLevelUp = () => {
    const currentLevel = getUserLevel();
    
    // Check if we've reached a new level
    if (currentLevel !== lastAwardedLevel && currentLevel !== "Beginner") {
      const levelInfo = getLevelInfo(currentLevel);
      
      // Award bonus gems
      const newBonusGems = bonusGems + levelInfo.reward;
      setBonusGems(newBonusGems);
      setLastAwardedLevel(currentLevel);
      saveProgress({ bonusGems: newBonusGems, lastAwardedLevel: currentLevel });
      
      // Show celebration
      setShowLevelUp(true);
      setTimeout(() => setShowLevelUp(false), 3000);
    }
    
    // Milestone bonuses (2000, 2500, 3000, etc.)
    if (currentPuzzleIndex >= 2000 && currentPuzzleIndex % 500 === 0) {
      const milestoneKey = `milestone_${currentPuzzleIndex}`;
      if (!lastAwardedLevel.includes(milestoneKey)) {
        const newBonusGems = bonusGems + 1000;
        setBonusGems(newBonusGems);
        setLastAwardedLevel(lastAwardedLevel + `,${milestoneKey}`);
        saveProgress({ bonusGems: newBonusGems, lastAwardedLevel: lastAwardedLevel + `,${milestoneKey}` });
      }
    }
  };

  const generateTileFlipPuzzle = (trivia) => {
    const size = currentPuzzleIndex < 10 ? 3 : currentPuzzleIndex < 50 ? 4 : 5;
    const row = Math.floor(Math.random() * size);
    const col = Math.floor(Math.random() * size);
    const patterns = Object.values(FLIP_PATTERNS);
    const pattern = patterns[Math.floor(Math.random() * patterns.length)];
    const colorIndex = Math.floor(currentPuzzleIndex / 7) % TILE_COLORS.length;
    
    const solvedGrid = Array(size).fill(null).map(() => Array(size).fill(1));
    const puzzleGrid = solvedGrid.map(r => [...r]);
    
    const flip = (r, c) => {
      if (r >= 0 && r < size && c >= 0 && c < size) {
        puzzleGrid[r][c] = puzzleGrid[r][c] === 1 ? 0 : 1;
      }
    };
    
    flip(row, col);
    
    switch(pattern) {
      case FLIP_PATTERNS.CROSS:
        flip(row - 1, col);
        flip(row + 1, col);
        flip(row, col - 1);
        flip(row, col + 1);
        break;
      case FLIP_PATTERNS.X_PATTERN:
        flip(row - 1, col - 1);
        flip(row - 1, col + 1);
        flip(row + 1, col - 1);
        flip(row + 1, col + 1);
        break;
      case FLIP_PATTERNS.SQUARE:
        for(let dr = -1; dr <= 1; dr++) {
          for(let dc = -1; dc <= 1; dc++) {
            if(dr !== 0 || dc !== 0) flip(row + dr, col + dc);
          }
        }
        break;
    }
    
    return {
      type: PUZZLE_TYPES.TILE_FLIP,
      grid: puzzleGrid,
      solution: { row, col },
      pattern,
      size,
      colorIndex,
      trivia
    };
  };

  const generateWordScramble = () => {
    // Pick random word from scramble bank (5+ letters only), avoiding recently used words
    let scrambleItem;
    let attempts = 0;
    do {
      scrambleItem = SCRAMBLE_BANK[Math.floor(Math.random() * SCRAMBLE_BANK.length)];
      attempts++;
    } while ((usedWords.includes(scrambleItem.word) || scrambleItem.word.length < 5) && attempts < 100);
    
    // Add word to used list and maintain 500-word buffer
    const newUsedWords = [...usedWords, scrambleItem.word];
    if (newUsedWords.length > 500) {
      newUsedWords.shift(); // Remove oldest word
    }
    setUsedWords(newUsedWords);
    saveProgress({ usedWords: newUsedWords });
    
    const word = scrambleItem.word;
    const letters = word.split('');
    for (let i = letters.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [letters[i], letters[j]] = [letters[j], letters[i]];
    }
    return {
      type: PUZZLE_TYPES.WORD_SCRAMBLE,
      scrambled: letters.join(''),
      answer: word,
      category: scrambleItem.cat
    };
  };

  const handleCategorySelect = (category) => {
    const categoryQuestions = TRIVIA_BANK.filter(q => q.cat === category);
    
    // Pick question not recently used (500-question buffer)
    let question;
    let attempts = 0;
    do {
      question = categoryQuestions[Math.floor(Math.random() * categoryQuestions.length)];
      attempts++;
    } while (usedTrivia.includes(question.q) && attempts < 50);
    
    // Add to buffer
    const newUsedTrivia = [...usedTrivia, question.q];
    if (newUsedTrivia.length > 500) {
      newUsedTrivia.shift();
    }
    setUsedTrivia(newUsedTrivia);
    saveProgress({ usedTrivia: newUsedTrivia });
    
    const choices = [...question.c];
    for (let i = choices.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [choices[i], choices[j]] = [choices[j], choices[i]];
    }
    
    setSelectedCategory(category);
    setCurrentTriviaQuestion(question);
    setShuffledChoices(choices);
    setTriviaFirstAttempt(true);
    setShowGemBreakdown(false); // Reset popup state
    setScreen('trivia');
  };

  const handleAnswerSelect = (answer) => {
    if (processing || showResult) return;
    
    setSelectedAnswer(answer);
    setShowResult(true);
    
    // Case-insensitive comparison
    if (answer.toLowerCase().trim() === currentTriviaQuestion.a.toLowerCase().trim()) {
      playSound('success');
      
      if (triviaFirstAttempt) {
        const newTriviaScore = triviaScore + 100;
        setTriviaScore(newTriviaScore);
        saveProgress({ triviaScore: newTriviaScore });
      }
      
      setTimeout(() => {
        setShowResult(false);
        setSelectedAnswer(null);
        
        // Generate puzzle
        const puzzleType = Math.random() > 0.5 ? PUZZLE_TYPES.TILE_FLIP : PUZZLE_TYPES.WORD_SCRAMBLE;
        
        if (puzzleType === PUZZLE_TYPES.TILE_FLIP) {
          const puzzle = generateTileFlipPuzzle(currentTriviaQuestion);
          setCurrentPuzzle(puzzle);
          setGrid(puzzle.grid);
          setHintLevel(0);
          setHighlightedArea(null);
          setScreen('puzzle_tile');
        } else {
          const puzzle = generateWordScramble();
          setCurrentPuzzle(puzzle);
          setScrambledWord(puzzle.scrambled);
          setUserWord('');
          setHintLevel(0);
          setScreen('puzzle_word');
        }
        
        setPuzzleFirstAttempt(true);
        setFailCount(0);
      }, 2000);
    } else {
      // Wrong answer - show correct answer and auto-advance
      setTriviaFirstAttempt(false);
      
      setTimeout(() => {
        setShowResult(false);
        setSelectedAnswer(null);
        
        // Auto-advance to puzzle
        const puzzleType = Math.random() > 0.5 ? PUZZLE_TYPES.TILE_FLIP : PUZZLE_TYPES.WORD_SCRAMBLE;
        
        if (puzzleType === PUZZLE_TYPES.TILE_FLIP) {
          const puzzle = generateTileFlipPuzzle(currentTriviaQuestion);
          setCurrentPuzzle(puzzle);
          setGrid(puzzle.grid);
          setHintLevel(0);
          setHighlightedArea(null);
          setScreen('puzzle_tile');
        } else {
          const puzzle = generateWordScramble();
          setCurrentPuzzle(puzzle);
          setScrambledWord(puzzle.scrambled);
          setUserWord('');
          setHintLevel(0);
          setScreen('puzzle_word');
        }
        
        setPuzzleFirstAttempt(true);
        setFailCount(0);
      }, 2000);
    }
  };

  const applyFlipPattern = (row, col, gridCopy, pattern) => {
    const flip = (r, c) => {
      if (r >= 0 && r < gridCopy.length && c >= 0 && c < gridCopy[0].length) {
        gridCopy[r][c] = gridCopy[r][c] === 1 ? 0 : 1;
      }
    };
    
    flip(row, col);
    
    switch(pattern) {
      case FLIP_PATTERNS.CROSS:
        flip(row - 1, col);
        flip(row + 1, col);
        flip(row, col - 1);
        flip(row, col + 1);
        break;
      case FLIP_PATTERNS.X_PATTERN:
        flip(row - 1, col - 1);
        flip(row - 1, col + 1);
        flip(row + 1, col - 1);
        flip(row + 1, col + 1);
        break;
      case FLIP_PATTERNS.SQUARE:
        for(let dr = -1; dr <= 1; dr++) {
          for(let dc = -1; dc <= 1; dc++) {
            if(dr !== 0 || dc !== 0) flip(row + dr, col + dc);
          }
        }
        break;
    }
  };

  const handleTileTap = async (row, col) => {
    if (processing) return;
    setProcessing(true);
    
    const newGrid = grid.map(r => [...r]);
    applyFlipPattern(row, col, newGrid, currentPuzzle.pattern);
    
    playSound('flip');
    setGrid(newGrid);
    
    await new Promise(resolve => setTimeout(resolve, 800));
    const isSolved = newGrid.every(row => row.every(tile => tile === 1));
    
    if (isSolved) {
      playSound('success');
      
      if (puzzleFirstAttempt) {
        const newPuzzleScore = puzzleScore + 100;
        setPuzzleScore(newPuzzleScore);
        saveProgress({ puzzleScore: newPuzzleScore });
      }
      
      setScreen('success');
      
      setTimeout(() => {
        const newIndex = currentPuzzleIndex + 1;
        setCurrentPuzzleIndex(newIndex);
        saveProgress({ currentIndex: newIndex });
        
        // Check for level up after state updates
        setTimeout(() => checkLevelUp(), 100);
        
        if (newIndex >= 500) {
          setScreen('complete');
        } else {
          // Auto-select random category
          const categories = Object.values(CATEGORIES);
          const randomCategory = categories[Math.floor(Math.random() * categories.length)];
          handleCategorySelect(randomCategory);
        }
        setProcessing(false);
      }, 2500);
    } else {
      // Wrong attempt - show for 2 seconds then auto-advance
      setPuzzleFirstAttempt(false);
      const newFailCount = failCount + 1;
      setFailCount(newFailCount);
      
      // Auto-advance after 2 seconds
      setTimeout(() => {
        const newIndex = currentPuzzleIndex + 1;
        setCurrentPuzzleIndex(newIndex);
        saveProgress({ currentIndex: newIndex });
        
        setTimeout(() => checkLevelUp(), 100);
        
        if (newIndex >= 500) {
          setScreen('complete');
        } else {
          // Auto-select random category for next trivia
          const categories = Object.values(CATEGORIES);
          const randomCategory = categories[Math.floor(Math.random() * categories.length)];
          handleCategorySelect(randomCategory);
        }
        setProcessing(false);
      }, 2000);
    }
  };

  const handleWordSubmit = () => {
    if (processing) return;
    
    // Remove underscores and spaces, compare case-insensitive
    const cleanUser = userWord.replace(/_/g, '').replace(/\s/g, '').toUpperCase();
    const cleanAnswer = currentPuzzle.answer.replace(/\s/g, '').toUpperCase();
    
    if (cleanUser === cleanAnswer) {
      playSound('success');
      
      if (puzzleFirstAttempt) {
        const newPuzzleScore = puzzleScore + 100;
        setPuzzleScore(newPuzzleScore);
        saveProgress({ puzzleScore: newPuzzleScore });
      }
      
      setScreen('success');
      
      setTimeout(() => {
        const newIndex = currentPuzzleIndex + 1;
        setCurrentPuzzleIndex(newIndex);
        saveProgress({ currentIndex: newIndex });
        
        setTimeout(() => checkLevelUp(), 100);
        
        if (newIndex >= 500) {
          setScreen('complete');
        } else {
          // Auto-select random category
          const categories = Object.values(CATEGORIES);
          const randomCategory = categories[Math.floor(Math.random() * categories.length)];
          handleCategorySelect(randomCategory);
        }
      }, 2500);
    } else {
      // Wrong attempt - show for 2 seconds then auto-advance
      setPuzzleFirstAttempt(false);
      const newFailCount = failCount + 1;
      setFailCount(newFailCount);
      setUserWord('');
      
      // Auto-advance after 2 seconds
      setTimeout(() => {
        const newIndex = currentPuzzleIndex + 1;
        setCurrentPuzzleIndex(newIndex);
        saveProgress({ currentIndex: newIndex });
        
        setTimeout(() => checkLevelUp(), 100);
        
        if (newIndex >= 500) {
          setScreen('complete');
        } else {
          // Auto-select random category for next trivia
          const categories = Object.values(CATEGORIES);
          const randomCategory = categories[Math.floor(Math.random() * categories.length)];
          handleCategorySelect(randomCategory);
        }
      }, 2000);
    }
  };

  useEffect(() => {
    if (screen === 'puzzle_word' && hintLevel > 0 && currentPuzzle) {
      const answer = currentPuzzle.answer.toUpperCase();
      let newWord = '';
      
      if (hintLevel === 1) {
        // Reveal first letter
        newWord = answer[0];
      } else if (hintLevel === 2) {
        // Reveal first 3 letters
        newWord = answer.substring(0, Math.min(3, answer.length));
      } else if (hintLevel === 3) {
        // Reveal all but last 2
        newWord = answer.substring(0, Math.max(1, answer.length - 2));
      } else if (hintLevel >= 4) {
        // Full answer
        newWord = answer;
      }
      
      setUserWord(newWord);
    }
  }, [hintLevel]);

  const handleHint1 = () => {
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    if (totalGems < 50 || hintLevel >= 1) return;
    
    const newGemsSpent = gemsSpent + 50;
    setGemsSpent(newGemsSpent);
    setHintLevel(1);
    saveProgress({ gemsSpent: newGemsSpent });
    
    if (currentPuzzle.type === PUZZLE_TYPES.TILE_FLIP) {
      const highlightType = Math.random() > 0.5 ? 'row' : 'col';
      setHighlightedArea({
        type: highlightType,
        index: highlightType === 'row' ? currentPuzzle.solution.row : currentPuzzle.solution.col
      });
    }
  };

  const handleHint2 = () => {
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    if (totalGems < 100 || hintLevel < 1 || hintLevel >= 2) return;
    
    const newGemsSpent = gemsSpent + 100;
    setGemsSpent(newGemsSpent);
    setHintLevel(2);
    saveProgress({ gemsSpent: newGemsSpent });
  };

  const handleHint3 = () => {
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    if (totalGems < 150 || hintLevel < 2 || hintLevel >= 3) return;
    
    const newGemsSpent = gemsSpent + 150;
    setGemsSpent(newGemsSpent);
    setHintLevel(3);
    saveProgress({ gemsSpent: newGemsSpent });
  };

  const handleHint4 = () => {
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    if (totalGems < 200 || hintLevel < 3 || hintLevel >= 4) return;
    
    const newGemsSpent = gemsSpent + 200;
    setGemsSpent(newGemsSpent);
    setHintLevel(4);
    saveProgress({ gemsSpent: newGemsSpent });
  };

  const handlePlay = () => {
    // Auto-select random category
    const categories = Object.values(CATEGORIES);
    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
    handleCategorySelect(randomCategory);
  };

  const handleHomeClick = () => {
    setScreen('home');
  };

  const handleSkipPuzzle = () => {
    const newSkipped = puzzlesSkipped + 1;
    setPuzzlesSkipped(newSkipped);
    setShowSkipConfirm(false);
    
    const newIndex = currentPuzzleIndex + 1;
    setCurrentPuzzleIndex(newIndex);
    saveProgress({ currentIndex: newIndex, puzzlesSkipped: newSkipped });
    
    if (newIndex >= 500) {
      setScreen('complete');
    } else {
      // Auto-select random category
      const categories = Object.values(CATEGORIES);
      const randomCategory = categories[Math.floor(Math.random() * categories.length)];
      handleCategorySelect(randomCategory);
    }
  };

  const renderGemBreakdown = () => {
    if (!showGemBreakdown) return null;
    
    return (
      <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-6" onClick={() => setShowGemBreakdown(false)}>
        <div className="bg-slate-800 rounded-2xl p-8 max-w-md border-2 border-amber-500" onClick={(e) => e.stopPropagation()}>
          <h2 className="text-3xl font-light text-white text-center mb-6">ðŸ’Ž YOUR GEMS</h2>
          
          <div className="space-y-6 text-slate-300">
            <div>
              <p className="text-amber-400 font-semibold mb-3">EARNED:</p>
              <div className="space-y-2 ml-3">
                <p className="flex justify-between">
                  <span>ðŸ’Ž Trivia:</span>
                  <span className="text-white font-bold">{triviaScore}</span>
                </p>
                <p className="flex justify-between">
                  <span>ðŸ’Ž Puzzles:</span>
                  <span className="text-white font-bold">{puzzleScore}</span>
                </p>
                {bonusGems > 0 && (
                  <p className="flex justify-between">
                    <span>ðŸ† Bonus Gems:</span>
                    <span className="text-white font-bold">{bonusGems}</span>
                  </p>
                )}
                {puzzlesSkipped > 0 && (
                  <p className="text-xs text-slate-400 ml-4">(Skipped: {puzzlesSkipped})</p>
                )}
              </div>
              <div className="border-t border-slate-600 mt-3 pt-2 ml-3">
                <p className="flex justify-between text-sm">
                  <span>Subtotal:</span>
                  <span className="text-white font-bold">{triviaScore + puzzleScore + bonusGems}</span>
                </p>
              </div>
            </div>
            
            {gemsSpent > 0 && (
              <div>
                <p className="text-red-400 font-semibold mb-3">SPENT:</p>
                <div className="ml-3">
                  <p className="flex justify-between">
                    <span>ðŸ’¡ Hints used:</span>
                    <span className="text-white font-bold">-{gemsSpent}</span>
                  </p>
                </div>
              </div>
            )}
            
            <div className="border-t-2 border-amber-500 pt-4">
              <p className="flex justify-between text-xl">
                <span className="text-white font-bold">ðŸ’Ž TOTAL:</span>
                <span className="text-amber-400 font-bold">{triviaScore + puzzleScore + bonusGems - gemsSpent}</span>
              </p>
            </div>
          </div>
          
          <button
            onClick={() => setShowGemBreakdown(false)}
            className="w-full mt-6 px-8 py-3 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-all duration-300 text-lg font-light"
          >
            Close
          </button>
        </div>
      </div>
    );
  };

  const getPatternName = (pattern) => {
    switch(pattern) {
      case FLIP_PATTERNS.CROSS: return 'Cross (+)';
      case FLIP_PATTERNS.X_PATTERN: return 'X Pattern';
      case FLIP_PATTERNS.SQUARE: return 'Square (3x3)';
      default: return '';
    }
  };

  // Splash Screen  
  if (screen === 'splash') {
    return (
      <div 
        className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 flex items-center justify-center cursor-pointer"
        onClick={() => setScreen('home')}
      >
        <div className="text-center space-y-8">
          <div className="relative inline-block">
            <div 
              className="w-48 h-48 rounded-3xl relative"
              style={{
                background: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%)',
                boxShadow: '0 0 60px rgba(59, 130, 246, 0.6), 0 0 100px rgba(59, 130, 246, 0.4), inset 0 0 40px rgba(255, 255, 255, 0.3)',
                transform: 'perspective(800px) rotateX(10deg) rotateY(-10deg)',
              }}
            >
              <div 
                className="absolute inset-0 rounded-3xl"
                style={{
                  background: 'radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.8) 0%, transparent 60%)',
                }}
              />
              <div className="absolute top-4 right-4 w-2 h-2 bg-white rounded-full animate-pulse" style={{boxShadow: '0 0 10px #fff'}} />
              <div className="absolute top-8 right-12 w-1 h-1 bg-white rounded-full animate-pulse" style={{animationDelay: '0.5s', boxShadow: '0 0 8px #fff'}} />
            </div>
          </div>
          
          <div>
            <h1 className="text-7xl font-extralight text-white tracking-wider mb-4">
              ONE MOVE
            </h1>
            <p className="text-3xl font-light text-blue-300 tracking-wide animate-pulse">
              WELCOME
            </p>
          </div>
        </div>
      </div>
    );
  }

  // Home Screen
  if (screen === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
        {showAboutGems && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-6" onClick={() => setShowAboutGems(false)}>
            <div className="bg-slate-800 rounded-2xl p-8 max-w-md border-2 border-amber-500" onClick={(e) => e.stopPropagation()}>
              <h2 className="text-3xl font-light text-white text-center mb-6">ðŸ’Ž ABOUT GEMS</h2>
              
              <div className="space-y-6 text-slate-300 text-sm">
                <div>
                  <p className="text-amber-400 font-semibold mb-2">EARN GEMS:</p>
                  <div className="space-y-1 ml-3">
                    <p>âœ“ Trivia correct (first try): <span className="text-white font-bold">+100</span></p>
                    <p>âœ“ Puzzle solved (first try): <span className="text-white font-bold">+100</span></p>
                  </div>
                </div>
                
                <div>
                  <p className="text-red-400 font-semibold mb-2">SPEND GEMS (HINTS):</p>
                  <div className="space-y-1 ml-3 text-xs">
                    <p>ðŸ’¡ Hint 1: <span className="text-white font-bold">-50</span></p>
                    <p>ðŸ’¡ Hint 2: <span className="text-white font-bold">-100</span></p>
                    <p>ðŸ’¡ Hint 3: <span className="text-white font-bold">-150</span></p>
                    <p>ðŸ’¡ Hint 4: <span className="text-white font-bold">-200</span></p>
                  </div>
                </div>
                
                <div>
                  <p className="text-blue-400 font-semibold mb-2">SKIP PUZZLES:</p>
                  <div className="ml-3 text-xs">
                    <p>â­ï¸ Skip (Free, no gems earned)</p>
                  </div>
                </div>
                
                <div className="bg-slate-700/50 rounded-lg p-3 text-xs">
                  <p className="text-center">Your gem total shows in the top right corner. Tap it anytime to see your full breakdown!</p>
                </div>
              </div>
              
              <button
                onClick={() => setShowAboutGems(false)}
                className="w-full mt-6 px-8 py-3 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-all duration-300 text-lg font-light"
              >
                Got It!
              </button>
            </div>
          </div>
        )}
        
        <button 
          onClick={() => setScreen('home')}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg z-50"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="absolute top-4 right-4 z-50">
          <button 
            onClick={(e) => {
              e.stopPropagation();
              setShowGemBreakdown(true);
            }}
            className="bg-gradient-to-br from-yellow-500 to-amber-600 px-3 py-2 rounded-lg text-center shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer flex items-center gap-2"
          >
            <span className="text-white text-lg font-bold">ðŸ’Ž</span>
            <span className="text-white text-xl font-bold">{triviaScore + puzzleScore + bonusGems - gemsSpent}</span>
          </button>
        </div>
        
        {renderGemBreakdown()}
        
        <div className="text-center space-y-8 max-w-md">
          <h1 className="text-6xl font-extralight text-white tracking-wider mb-8">
            ONE MOVE <span className="text-green-400 text-2xl">v6.2-TEST</span>
          </h1>
          
          <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
            <div className="flex items-center justify-center gap-4 mb-2">
              <p className="text-amber-400 text-2xl font-semibold">{getUserLevel()}</p>
              {getLevelInfo(getUserLevel()).icon && (
                <span className="text-5xl">{getLevelInfo(getUserLevel()).icon}</span>
              )}
            </div>
            <p className="text-slate-400 text-sm">Answer trivia â€¢ Solve puzzles â€¢ Earn gems</p>
          </div>
          
          <div className="space-y-3">
            <button
              onClick={handlePlay}
              className="w-full px-12 py-5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 flex items-center justify-center gap-3 text-xl font-light tracking-wide shadow-lg"
            >
              <Play className="w-6 h-6" />
              <span>PLAY</span>
            </button>
            
            <button
              onClick={() => setScreen('instructions')}
              className="w-full px-8 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all duration-300 text-sm font-light tracking-wide"
            >
              HOW TO PLAY
            </button>
            
            <button
              onClick={() => setShowAboutGems(true)}
              className="w-full px-8 py-3 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-all duration-300 text-sm font-light tracking-wide"
            >
              ðŸ’Ž About Gems
            </button>
          </div>
        </div>
      </div>
    );
  }

  // Instructions Screen
  if (screen === 'instructions') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-6">
        <button 
          onClick={() => setScreen('home')}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg"
        >
          <Home className="w-6 h-6 text-white" />
        </button>

        <div className="max-w-2xl mx-auto pt-20">
          <h1 className="text-4xl font-light text-white text-center mb-3">How to Play</h1>
          <p className="text-slate-400 text-center mb-12">Tap a puzzle type to learn more</p>
          
          <div className="grid grid-cols-1 gap-4">
            {/* Tile Flip Card */}
            <button
              onClick={() => setShowInstructionPopup('tile_flip')}
              className="bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl p-6 text-left transition-all duration-300 shadow-lg transform hover:scale-105"
            >
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 bg-white/20 rounded-lg flex items-center justify-center">
                  <div className="grid grid-cols-2 gap-1">
                    <div className="w-3 h-3 bg-blue-300 rounded"></div>
                    <div className="w-3 h-3 bg-slate-700 rounded"></div>
                    <div className="w-3 h-3 bg-slate-700 rounded"></div>
                    <div className="w-3 h-3 bg-blue-300 rounded"></div>
                  </div>
                </div>
                <div>
                  <h3 className="text-xl font-semibold text-white">TILE FLIP</h3>
                  <p className="text-blue-200 text-sm">Find the one correct tile</p>
                </div>
              </div>
            </button>

            {/* Word Scramble Card */}
            <button
              onClick={() => setShowInstructionPopup('word_scramble')}
              className="bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 rounded-xl p-6 text-left transition-all duration-300 shadow-lg transform hover:scale-105"
            >
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 bg-white/20 rounded-lg flex items-center justify-center">
                  <span className="text-2xl font-bold text-white">ABC</span>
                </div>
                <div>
                  <h3 className="text-xl font-semibold text-white">WORD SCRAMBLE</h3>
                  <p className="text-purple-200 text-sm">Unscramble the letters</p>
                </div>
              </div>
            </button>

            {/* Coming Soon Cards */}
            <div className="bg-slate-800/50 border-2 border-slate-700 border-dashed rounded-xl p-6 text-left opacity-50">
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 bg-slate-700 rounded-lg flex items-center justify-center">
                  <span className="text-2xl">ðŸ”¢</span>
                </div>
                <div>
                  <h3 className="text-xl font-semibold text-slate-400">QUICK MATH</h3>
                  <p className="text-slate-500 text-sm">Coming soon...</p>
                </div>
              </div>
            </div>

            <div className="bg-slate-800/50 border-2 border-slate-700 border-dashed rounded-xl p-6 text-left opacity-50">
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 bg-slate-700 rounded-lg flex items-center justify-center">
                  <span className="text-2xl">ðŸ§ </span>
                </div>
                <div>
                  <h3 className="text-xl font-semibold text-slate-400">MEMORY MATCH</h3>
                  <p className="text-slate-500 text-sm">Coming soon...</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Tile Flip Popup */}
        {showInstructionPopup === 'tile_flip' && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-6" onClick={() => setShowInstructionPopup(null)}>
            <div className="bg-slate-800 rounded-2xl p-8 max-w-lg border-2 border-blue-500 overflow-y-auto max-h-[90vh]" onClick={(e) => e.stopPropagation()}>
              <h2 className="text-3xl font-light text-white text-center mb-6">TILE FLIP</h2>
              
              <div className="space-y-6">
                <p className="text-slate-300 text-center text-lg">
                  Goal: Find the <span className="text-yellow-400 font-bold">ONE</span> tile that makes all tiles the same color!
                </p>

                {/* Visual Demo */}
                <div className="bg-slate-900 rounded-xl p-6">
                  <div className="flex items-center justify-center gap-6 mb-4">
                    <div className="text-center">
                      <p className="text-slate-400 text-xs mb-3 font-semibold">BEFORE TAP</p>
                      <div className="grid grid-cols-3 gap-1 bg-slate-950 p-2 rounded-lg">
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-slate-700 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-yellow-400 rounded-lg shadow-lg border-4 border-yellow-300 relative" style={{boxShadow: '0 0 20px rgba(251, 191, 36, 0.8)'}}>
                          <div className="absolute inset-0 flex items-center justify-center text-slate-800 font-bold text-xs">TAP</div>
                        </div>
                        <div className="w-14 h-14 bg-slate-700 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-slate-700 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-slate-700 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                      </div>
                      <p className="text-slate-500 text-xs mt-2 italic">Mixed colors</p>
                    </div>
                    
                    <div className="text-3xl text-blue-400 font-bold">â†’</div>
                    
                    <div className="text-center">
                      <p className="text-slate-400 text-xs mb-3 font-semibold">AFTER TAP</p>
                      <div className="grid grid-cols-3 gap-1 bg-slate-950 p-2 rounded-lg">
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                        <div className="w-14 h-14 bg-blue-500 rounded-lg shadow-lg border-2 border-slate-800"></div>
                      </div>
                      <p className="text-green-400 text-xs mt-2 italic font-semibold">âœ“ All same!</p>
                    </div>
                  </div>
                  
                  <p className="text-center text-sm text-blue-300 font-light mt-4">Tapping the center tile flips 5 tiles (itself + cross pattern)</p>
                </div>

                <div className="space-y-3 text-slate-300">
                  <p className="flex items-start gap-2">
                    <span className="text-blue-400 font-bold">â€¢</span>
                    <span>Tapping 1 tile flips that tile and nearby tiles</span>
                  </p>
                  <p className="flex items-start gap-2">
                    <span className="text-blue-400 font-bold">â€¢</span>
                    <span>Only <span className="text-yellow-400 font-bold">ONE</span> tap solves the puzzle</span>
                  </p>
                  <p className="flex items-start gap-2">
                    <span className="text-blue-400 font-bold">â€¢</span>
                    <span>Solve on first try for gems!</span>
                  </p>
                </div>
              </div>
              
              <button
                onClick={() => setShowInstructionPopup(null)}
                className="w-full mt-6 px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 text-lg font-light"
              >
                Got It!
              </button>
            </div>
          </div>
        )}

        {/* Word Scramble Popup */}
        {showInstructionPopup === 'word_scramble' && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-6" onClick={() => setShowInstructionPopup(null)}>
            <div className="bg-slate-800 rounded-2xl p-8 max-w-lg border-2 border-purple-500 overflow-y-auto max-h-[90vh]" onClick={(e) => e.stopPropagation()}>
              <h2 className="text-3xl font-light text-white text-center mb-6">WORD SCRAMBLE</h2>
              
              <div className="space-y-6">
                <p className="text-slate-300 text-center text-lg">
                  Goal: Unscramble the letters to form the correct word
                </p>

                {/* Visual Demo */}
                <div className="bg-slate-900 rounded-xl p-6">
                  <div className="text-center space-y-4">
                    <div>
                      <p className="text-slate-400 text-xs mb-2">SCRAMBLED</p>
                      <div className="flex justify-center gap-2">
                        {['O', 'G', 'L', 'M', 'I', 'N', 'A', 'B'].map((letter, i) => (
                          <div key={i} className="w-10 h-10 bg-purple-600 rounded flex items-center justify-center text-white font-bold text-lg">
                            {letter}
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    <div className="text-2xl text-purple-400">â†“</div>
                    
                    <div>
                      <p className="text-slate-400 text-xs mb-2">UNSCRAMBLED</p>
                      <div className="flex justify-center gap-2">
                        {['M', 'O', 'N', 'G', 'O', 'L', 'I', 'A'].map((letter, i) => (
                          <div key={i} className="w-10 h-10 bg-green-600 rounded flex items-center justify-center text-white font-bold text-lg">
                            {letter}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>

                <div className="space-y-3 text-slate-300">
                  <p className="flex items-start gap-2">
                    <span className="text-purple-400 font-bold">â€¢</span>
                    <span>Type the unscrambled word</span>
                  </p>
                  <p className="flex items-start gap-2">
                    <span className="text-purple-400 font-bold">â€¢</span>
                    <span>Use hints if you get stuck</span>
                  </p>
                  <p className="flex items-start gap-2">
                    <span className="text-purple-400 font-bold">â€¢</span>
                    <span>Solve on first try for gems!</span>
                  </p>
                </div>
              </div>
              
              <button
                onClick={() => setShowInstructionPopup(null)}
                className="w-full mt-6 px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-300 text-lg font-light"
              >
                Got It!
              </button>
            </div>
          </div>
        )}
      </div>
    );
  }

  // Category Selection
  if (screen === 'category_select') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
        <button 
          onClick={handleHomeClick}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="absolute top-4 right-4 z-50">
          <div className="bg-gradient-to-br from-yellow-500 to-amber-600 px-3 py-2 rounded-lg text-center shadow-lg flex items-center gap-2">
            <span className="text-white text-lg font-bold">ðŸ’Ž</span>
            <span className="text-white text-xl font-bold">{triviaScore + puzzleScore + bonusGems - gemsSpent}</span>
          </div>
        </div>
        
        <div className="max-w-2xl w-full space-y-8">
          <div className="text-center">
            <div className="text-slate-500 text-sm mb-2">Challenge {currentPuzzleIndex + 1}</div>
            <h2 className="text-3xl font-light text-white mb-4">
              Choose Your Category
            </h2>
          </div>
          
          <div className="grid grid-cols-2 gap-4">
            {Object.values(CATEGORIES).map((category) => (
              <button
                key={category}
                onClick={() => handleCategorySelect(category)}
                className="p-6 rounded-xl text-lg font-light transition-all duration-300 bg-slate-800/50 text-white hover:bg-slate-700/50 border border-slate-700 hover:border-blue-500"
              >
                {category}
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // Trivia Screen
  if (screen === 'trivia' && currentTriviaQuestion) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
        <button 
          onClick={handleHomeClick}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="absolute top-4 right-4 z-50">
          <div className="bg-gradient-to-br from-yellow-500 to-amber-600 px-3 py-2 rounded-lg text-center shadow-lg flex items-center gap-2">
            <span className="text-white text-lg font-bold">ðŸ’Ž</span>
            <span className="text-white text-xl font-bold">{triviaScore + puzzleScore + bonusGems - gemsSpent}</span>
          </div>
        </div>
        
        <div className="max-w-2xl w-full space-y-8 mt-16">
          <div className="text-center">
            <div className="mb-4">
              <span className="text-amber-400 text-2xl font-bold uppercase">{selectedCategory}</span>
            </div>
            <h2 className="text-3xl font-light text-white mb-8">
              {currentTriviaQuestion.q}
            </h2>
          </div>
          
          <div className="grid grid-cols-1 gap-4">
            {shuffledChoices.map((choice, index) => (
              <button
                key={index}
                onClick={() => handleAnswerSelect(choice)}
                disabled={showResult}
                className={`
                  p-6 rounded-xl text-lg font-light transition-all duration-300
                  ${showResult && choice === selectedAnswer && choice.toLowerCase().trim() === currentTriviaQuestion.a.toLowerCase().trim()
                    ? 'bg-green-600 text-white scale-105'
                    : showResult && choice === selectedAnswer && choice.toLowerCase().trim() !== currentTriviaQuestion.a.toLowerCase().trim()
                    ? 'bg-red-600 text-white'
                    : showResult && choice.toLowerCase().trim() === currentTriviaQuestion.a.toLowerCase().trim()
                    ? 'bg-green-600 text-white animate-pulse'
                    : showResult
                    ? 'bg-slate-800/30 text-slate-500 cursor-not-allowed'
                    : 'bg-slate-800/50 text-white hover:bg-slate-700/50 border border-slate-700 hover:border-blue-500'
                  }
                `}
              >
                {choice}
              </button>
            ))}
          </div>
          
          {showResult && selectedAnswer.toLowerCase().trim() === currentTriviaQuestion.a.toLowerCase().trim() && (
            <div className="text-center text-2xl font-light text-green-400 animate-pulse">
              Correct! âœ“
            </div>
          )}
          
          {showResult && selectedAnswer.toLowerCase().trim() !== currentTriviaQuestion.a.toLowerCase().trim() && (
            <div className="text-center space-y-2">
              <div className="text-2xl font-light text-red-400 animate-pulse">
                Incorrect!
              </div>
            </div>
          )}
        </div>
        
        {renderLevelUpPopup()}
      </div>
    );
  }

  // Tile Flip Puzzle
  if (screen === 'puzzle_tile' && currentPuzzle) {
    const gridSize = currentPuzzle.size;
    const tileSize = gridSize === 3 ? 'w-16 h-16' : gridSize === 4 ? 'w-14 h-14' : 'w-10 h-10';
    const tileColor = TILE_COLORS[currentPuzzle.colorIndex];
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
        <button 
          onClick={handleHomeClick}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg z-50"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="absolute top-4 right-4 z-50">
          <div className="bg-gradient-to-br from-yellow-500 to-amber-600 px-3 py-2 rounded-lg text-center shadow-lg flex items-center gap-2">
            <span className="text-white text-lg font-bold">ðŸ’Ž</span>
            <span className="text-white text-xl font-bold">{totalGems}</span>
          </div>
        </div>
        
        <div className="space-y-3 max-w-sm">
          <div className="text-center mb-2">
            <p className="text-white text-base font-light">Tile Flip Challenge</p>
            {gridSize >= 4 && (
              <p className="text-orange-400 text-xs font-bold mt-0.5">âš ï¸ HARD PUZZLE</p>
            )}
            <p className="text-slate-400 text-xs mt-0.5">Make all tiles match!</p>
            {!puzzleFirstAttempt && (
              <p className="text-yellow-400 text-xs mt-0.5">âš ï¸ First attempt failed</p>
            )}
          </div>
          
          {hintLevel >= 2 && (
            <div className="text-center">
              <div className="inline-block bg-amber-500/20 border-2 border-amber-500 rounded-lg px-4 py-2">
                <p className="text-amber-400 text-base font-bold">Pattern: {getPatternName(currentPuzzle.pattern)}</p>
              </div>
            </div>
          )}
          
          <div 
            className="inline-grid gap-2 p-4 bg-slate-800/30 rounded-2xl backdrop-blur-sm"
            style={{ gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))` }}
          >
            {grid.map((row, rowIndex) => (
              row.map((tile, colIndex) => {
                const isInHighlightedArea = highlightedArea && (
                  (highlightedArea.type === 'row' && rowIndex === highlightedArea.index) ||
                  (highlightedArea.type === 'col' && colIndex === highlightedArea.index)
                );
                const isExactTile = hintLevel >= 3 && 
                  rowIndex === currentPuzzle.solution.row && 
                  colIndex === currentPuzzle.solution.col;
                const showTapHere = hintLevel >= 4 && isExactTile;
                
                return (
                  <button
                    key={`${rowIndex}-${colIndex}`}
                    onClick={() => handleTileTap(rowIndex, colIndex)}
                    disabled={processing}
                    className={`
                      ${tileSize}
                      rounded-lg
                      transition-all duration-300
                      relative
                      ${tile === 1 
                        ? `bg-gradient-to-br ${tileColor.from} ${tileColor.to} shadow-lg ${tileColor.shadow} hover:shadow-${tileColor.shadow}/70 hover:scale-105` 
                        : 'bg-slate-800 border-2 border-slate-700'
                      }
                      ${isInHighlightedArea ? 'ring-4 ring-amber-400 ring-opacity-70' : ''}
                      ${isExactTile ? 'exact-tile-highlight' : ''}
                      ${processing ? 'cursor-not-allowed' : 'cursor-pointer'}
                    `}
                  >
                    {showTapHere && (
                      <div className="tap-here-overlay">
                        TAP HERE
                      </div>
                    )}
                  </button>
                );
              })
            ))}
          </div>
          
          <div className="space-y-2">
            <button
              onClick={handleHint1}
              disabled={totalGems < 50 || hintLevel >= 1}
              className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                totalGems < 50 || hintLevel >= 1
                  ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                  : 'bg-amber-600 hover:bg-amber-700 text-white'
              }`}
            >
              ðŸ’¡ Hint 1: Highlight Area (-50 gems) {hintLevel >= 1 ? 'âœ“' : ''}
            </button>
            
            {hintLevel >= 1 && (
              <button
                onClick={handleHint2}
                disabled={totalGems < 100 || hintLevel >= 2}
                className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                  totalGems < 100 || hintLevel >= 2
                    ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                    : 'bg-amber-600 hover:bg-amber-700 text-white'
                }`}
              >
                ðŸ’¡ Hint 2: Show Pattern (-100 gems) {hintLevel >= 2 ? 'âœ“' : ''}
              </button>
            )}
            
            {hintLevel >= 2 && (
              <button
                onClick={handleHint3}
                disabled={totalGems < 150 || hintLevel >= 3}
                className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                  totalGems < 150 || hintLevel >= 3
                    ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                    : 'bg-amber-600 hover:bg-amber-700 text-white'
                }`}
              >
                ðŸ’¡ Hint 3: Exact Tile (-150 gems) {hintLevel >= 3 ? 'âœ“' : ''}
              </button>
            )}
            
            {hintLevel >= 3 && (
              <button
                onClick={handleHint4}
                disabled={totalGems < 200 || hintLevel >= 4}
                className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                  totalGems < 200 || hintLevel >= 4
                    ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                    : 'bg-amber-600 hover:bg-amber-700 text-white'
                }`}
              >
                ðŸ’¡ Hint 4: Tap Here (-200 gems) {hintLevel >= 4 ? 'âœ“' : ''}
              </button>
            )}
            
            <button
              onClick={() => setShowSkipConfirm(true)}
              className="w-full px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm transition-all duration-300"
            >
              â­ï¸ Skip Puzzle (Free, 0 gems)
            </button>
          </div>
        </div>
        
        {showSkipConfirm && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-6" onClick={() => setShowSkipConfirm(false)}>
            <div className="bg-slate-800 rounded-2xl p-8 max-w-md border-2 border-red-500" onClick={(e) => e.stopPropagation()}>
              <h2 className="text-2xl font-light text-white text-center mb-4">Skip This Puzzle?</h2>
              <p className="text-slate-300 text-center mb-6">You won't earn any gems for this puzzle.</p>
              
              <div className="flex gap-4">
                <button
                  onClick={() => setShowSkipConfirm(false)}
                  className="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all duration-300"
                >
                  Cancel
                </button>
                <button
                  onClick={handleSkipPuzzle}
                  className="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all duration-300"
                >
                  Skip
                </button>
              </div>
            </div>
          </div>
        )}
        
        {renderLevelUpPopup()}
      </div>
    );
  }

  // Word Scramble Puzzle
  if (screen === 'puzzle_word' && currentPuzzle) {
    const totalGems = triviaScore + puzzleScore + bonusGems - gemsSpent;
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
        <button 
          onClick={handleHomeClick}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="absolute top-4 right-4 z-50">
          <div className="bg-gradient-to-br from-yellow-500 to-amber-600 px-3 py-2 rounded-lg shadow-lg flex items-center gap-2">
            <span className="text-white text-lg font-bold">ðŸ’Ž</span>
            <span className="text-white text-xl font-bold">{totalGems}</span>
          </div>
        </div>
        
        <div className="max-w-2xl w-full space-y-4 mt-20">
          <div className="text-center space-y-3">
            <p className="text-amber-400 text-2xl font-bold mb-3">{currentPuzzle.category}</p>
            <p className="text-white text-lg font-light">Word Scramble Challenge</p>
            <p className="text-slate-400 text-sm">Unscramble the letters!</p>
            {!puzzleFirstAttempt && (
              <p className="text-yellow-400 text-xs mt-2">âš ï¸ First attempt failed - no gems</p>
            )}
          </div>
          
          <div className="bg-slate-800/50 rounded-xl p-6 text-center space-y-4">
            <div className="text-3xl font-light text-white tracking-widest mb-4">
              {scrambledWord}
            </div>
            
            <input
              type="text"
              value={userWord}
              onChange={(e) => setUserWord(e.target.value.toUpperCase())}
              placeholder="Type your answer..."
              className="w-full px-6 py-3 bg-slate-900 text-white text-center text-xl rounded-lg border-2 border-slate-700 focus:border-blue-500 outline-none"
              autoCapitalize="characters"
              autoComplete="off"
              autoCorrect="off"
            />
            
            <button
              onClick={handleWordSubmit}
              className="w-full px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-lg font-light"
            >
              Submit Answer
            </button>
            
            <div className="space-y-2">
              <button
                onClick={handleHint1}
                disabled={totalGems < 50 || hintLevel >= 1}
                className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                  totalGems < 50 || hintLevel >= 1
                    ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                    : 'bg-amber-600 hover:bg-amber-700 text-white'
                }`}
              >
                ðŸ’¡ Hint 1: First Letter (-50 gems) {hintLevel >= 1 ? 'âœ“' : ''}
              </button>
              
              {hintLevel >= 1 && (
                <button
                  onClick={handleHint2}
                  disabled={totalGems < 100 || hintLevel >= 2}
                  className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                    totalGems < 100 || hintLevel >= 2
                      ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                      : 'bg-amber-600 hover:bg-amber-700 text-white'
                  }`}
                >
                  ðŸ’¡ Hint 2: First 3 Letters (-100 gems) {hintLevel >= 2 ? 'âœ“' : ''}
                </button>
              )}
              
              {hintLevel >= 2 && (
                <button
                  onClick={handleHint3}
                  disabled={totalGems < 150 || hintLevel >= 3}
                  className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                    totalGems < 150 || hintLevel >= 3
                      ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                      : 'bg-amber-600 hover:bg-amber-700 text-white'
                  }`}
                >
                  ðŸ’¡ Hint 3: All But Last 2 (-150 gems) {hintLevel >= 3 ? 'âœ“' : ''}
                </button>
              )}
              
              {hintLevel >= 3 && (
                <button
                  onClick={handleHint4}
                  disabled={totalGems < 200 || hintLevel >= 4}
                  className={`w-full px-4 py-2 rounded-lg text-sm transition-all duration-300 ${
                    totalGems < 200 || hintLevel >= 4
                      ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                      : 'bg-amber-600 hover:bg-amber-700 text-white'
                  }`}
                >
                  ðŸ’¡ Hint 4: Full Answer (-200 gems) {hintLevel >= 4 ? 'âœ“' : ''}
                </button>
              )}
            </div>
            
            <button
              onClick={() => setShowSkipConfirm(true)}
              className="w-full px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm transition-all duration-300"
            >
              â­ï¸ Skip Puzzle (Free, 0 gems)
            </button>
          </div>
        </div>
        
        {showSkipConfirm && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-6" onClick={() => setShowSkipConfirm(false)}>
            <div className="bg-slate-800 rounded-2xl p-8 max-w-md border-2 border-red-500" onClick={(e) => e.stopPropagation()}>
              <h2 className="text-2xl font-light text-white text-center mb-4">Skip This Puzzle?</h2>
              <p className="text-slate-300 text-center mb-6">You won't earn any gems for this puzzle.</p>
              
              <div className="flex gap-4">
                <button
                  onClick={() => setShowSkipConfirm(false)}
                  className="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all duration-300"
                >
                  Cancel
                </button>
                <button
                  onClick={handleSkipPuzzle}
                  className="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all duration-300"
                >
                  Skip
                </button>
              </div>
            </div>
          </div>
        )}
        
        {renderLevelUpPopup()}
      </div>
    );
  }

  // Success Screen
  if (screen === 'success') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
        <button 
          onClick={handleHomeClick}
          className="absolute top-4 left-4 p-3 bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 rounded-lg transition-all duration-300 shadow-lg"
        >
          <Home className="w-6 h-6 text-white" />
        </button>
        
        <div className="text-center space-y-8">
          <h2 className="text-5xl font-extralight text-white tracking-wider">
            Solved! âœ“
          </h2>
          
          {currentPuzzle.type === PUZZLE_TYPES.TILE_FLIP && (
            <div className="max-w-md mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700">
              <p className="text-slate-400 text-sm font-light mb-2">
                {currentPuzzle.trivia.q}
              </p>
              <p className="text-white text-2xl font-light">
                {currentPuzzle.trivia.a}
              </p>
            </div>
          )}
          
          {currentPuzzle.type === PUZZLE_TYPES.WORD_SCRAMBLE && (
            <div className="max-w-md mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700">
              <p className="text-slate-400 text-sm font-light mb-2">
                {currentPuzzle.category}
              </p>
              <p className="text-white text-2xl font-light">
                {currentPuzzle.answer}
              </p>
            </div>
          )}
        </div>
      </div>
    );
  }

  // Level-Up Celebration Popup
  const renderLevelUpPopup = () => {
    if (!showLevelUp) return null;
    
    const currentLevel = getUserLevel();
    const levelInfo = getLevelInfo(currentLevel);
    
    return (
      <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-6">
        <div className="bg-gradient-to-br from-amber-600 to-amber-700 rounded-2xl p-10 max-w-md border-4 border-yellow-400 shadow-2xl animate-pulse">
          <div className="text-center space-y-6">
            <div className="text-8xl mb-6">{levelInfo.icon}</div>
            <h2 className="text-5xl font-bold text-white">LEVEL UP!</h2>
            <p className="text-3xl text-yellow-100 font-semibold">{currentLevel}</p>
            <div className="bg-white/20 rounded-lg p-6 mt-6">
              <p className="text-white text-2xl font-bold">+{levelInfo.reward} BONUS GEMS! ðŸ’Ž</p>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Complete Screen
  if (screen === 'complete') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 flex items-center justify-center p-6">
        <div className="text-center space-y-8 max-w-2xl">
          <h2 className="text-5xl font-extralight text-white tracking-wider mb-4">
            Complete! ðŸŽ‰
          </h2>
          
          <div className="bg-slate-800/50 rounded-xl p-8 border border-yellow-400/30">
            <div className="grid grid-cols-2 gap-4 text-white">
              <div>
                <div className="text-3xl font-light">{triviaScore}</div>
                <div className="text-xs text-slate-400">Trivia Correct</div>
              </div>
              <div>
                <div className="text-3xl font-light">{puzzleScore}</div>
                <div className="text-xs text-slate-400">Puzzles Solved</div>
              </div>
            </div>
          </div>
          
          <button
            onClick={() => {
              localStorage.removeItem('oneMoveSave_v4');
              setScreen('home');
              setCurrentPuzzleIndex(0);
              setTriviaScore(0);
              setPuzzleScore(0);
              setGemsSpent(0);
              setPuzzlesSkipped(0);
            }}
            className="px-12 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 text-lg font-light tracking-wide"
          >
            Play Again
          </button>
        </div>
      </div>
    );
  }

  return null;
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<OneMove />);
  </script>
</body>
</html>
