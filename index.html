<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>ONE MOVE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      background: #1e293b;
    }
    #root {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const Play = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polygon points="5 3 19 12 5 21 5 3"/>
      </svg>
    );

    const Trophy = ({ className }) => (
      <svg className={className} width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
        <path d="M4 22h16"/>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
      </svg>
    );

    // Flip pattern definitions
    const FLIP_PATTERNS = {
      CROSS: 'cross',      // + pattern (center + 4 neighbors)
      X_PATTERN: 'x',      // X pattern (center + 4 diagonals)
      SQUARE: 'square',    // center + all 8 surrounding
      L_SHAPE: 'l',        // L-shaped pattern
      LINE_H: 'line_h',    // horizontal line
      LINE_V: 'line_v',    // vertical line
    };

    const generatePuzzle = (id, gridSize, solutionRow, solutionCol, trivia, pattern = FLIP_PATTERNS.CROSS) => {
      const solvedGrid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(1));
      const puzzleGrid = solvedGrid.map(row => [...row]);
      
      const flip = (r, c) => {
        if (r >= 0 && r < gridSize && c >= 0 && c < gridSize) {
          puzzleGrid[r][c] = puzzleGrid[r][c] === 1 ? 0 : 1;
        }
      };
      
      // Flip the solution tile
      flip(solutionRow, solutionCol);
      
      // Apply pattern
      switch(pattern) {
        case FLIP_PATTERNS.CROSS:
          flip(solutionRow - 1, solutionCol);
          flip(solutionRow + 1, solutionCol);
          flip(solutionRow, solutionCol - 1);
          flip(solutionRow, solutionCol + 1);
          break;
        case FLIP_PATTERNS.X_PATTERN:
          flip(solutionRow - 1, solutionCol - 1);
          flip(solutionRow - 1, solutionCol + 1);
          flip(solutionRow + 1, solutionCol - 1);
          flip(solutionRow + 1, solutionCol + 1);
          break;
        case FLIP_PATTERNS.SQUARE:
          for(let dr = -1; dr <= 1; dr++) {
            for(let dc = -1; dc <= 1; dc++) {
              if(dr !== 0 || dc !== 0) flip(solutionRow + dr, solutionCol + dc);
            }
          }
          break;
        case FLIP_PATTERNS.L_SHAPE:
          flip(solutionRow - 1, solutionCol);
          flip(solutionRow, solutionCol + 1);
          break;
        case FLIP_PATTERNS.LINE_H:
          flip(solutionRow, solutionCol - 1);
          flip(solutionRow, solutionCol + 1);
          break;
        case FLIP_PATTERNS.LINE_V:
          flip(solutionRow - 1, solutionCol);
          flip(solutionRow + 1, solutionCol);
          break;
      }
      
      return { id, grid: puzzleGrid, solution: { row: solutionRow, col: solutionCol }, trivia, pattern, gridSize };
    };

    // 300 Trivia questions organized by difficulty
    const ALL_TRIVIA = {
      easy: [
        {q: "What's the tallest mountain?", a: "Mount Everest", c: ["K2", "Mount Everest", "Kilimanjaro", "Denali"]},
        {q: "What ocean is largest?", a: "Pacific Ocean", c: ["Atlantic", "Indian", "Pacific Ocean", "Arctic"]},
        {q: "Fastest land animal?", a: "Cheetah", c: ["Lion", "Cheetah", "Leopard", "Tiger"]},
        {q: "The Red Planet?", a: "Mars", c: ["Venus", "Jupiter", "Mars", "Mercury"]},
        {q: "Smallest country?", a: "Vatican City", c: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"]},
        {q: "Longest river?", a: "Nile River", c: ["Amazon", "Nile River", "Yangtze", "Mississippi"]},
        {q: "Largest mammal?", a: "Blue Whale", c: ["Elephant", "Blue Whale", "Giraffe", "Hippo"]},
        {q: "Most populous country?", a: "India", c: ["China", "India", "USA", "Indonesia"]},
        {q: "Hottest desert?", a: "Sahara", c: ["Gobi", "Mojave", "Sahara", "Arabian"]},
        {q: "Pizza origin country?", a: "Italy", c: ["Greece", "Italy", "France", "Spain"]},
        {q: "Capital of Japan?", a: "Tokyo", c: ["Seoul", "Tokyo", "Beijing", "Bangkok"]},
        {q: "Flightless fast bird?", a: "Ostrich", c: ["Penguin", "Ostrich", "Emu", "Kiwi"]},
        {q: "Egypt's continent?", a: "Africa", c: ["Asia", "Africa", "Europe", "Middle East"]},
        {q: "Largest island?", a: "Greenland", c: ["Australia", "Greenland", "New Guinea", "Borneo"]},
        {q: "Black & white stripes?", a: "Zebra", c: ["Tiger", "Zebra", "Panda", "Skunk"]},
        {q: "Longest wall?", a: "Great Wall of China", c: ["Hadrian's", "Great Wall of China", "Berlin", "Western"]},
        {q: "Planet with rings?", a: "Saturn", c: ["Jupiter", "Saturn", "Uranus", "Neptune"]},
        {q: "Kangaroos live where?", a: "Australia", c: ["New Zealand", "Australia", "South Africa", "India"]},
        {q: "Coldest ocean?", a: "Arctic", c: ["Antarctic", "Arctic", "Atlantic", "Pacific"]},
        {q: "Tallest tree species?", a: "Coast Redwood", c: ["Sequoia", "Coast Redwood", "Douglas Fir", "Eucalyptus"]},
        {q: "Eiffel Tower city?", a: "Paris", c: ["London", "Paris", "Rome", "Berlin"]},
        {q: "Arctic animal?", a: "Polar Bear", c: ["Grizzly", "Polar Bear", "Panda", "Black Bear"]},
        {q: "Boot-shaped country?", a: "Italy", c: ["Spain", "Italy", "Greece", "Portugal"]},
        {q: "Deepest ocean trench?", a: "Mariana", c: ["Tonga", "Mariana", "Java", "Puerto Rico"]},
        {q: "Pink bird?", a: "Flamingo", c: ["Parrot", "Flamingo", "Toucan", "Ibis"]},
        {q: "Pyramids country?", a: "Egypt", c: ["Mexico", "Egypt", "Sudan", "Peru"]},
        {q: "Largest rainforest?", a: "Amazon", c: ["Congo", "Amazon", "Daintree", "Borneo"]},
        {q: "King of jungle?", a: "Lion", c: ["Tiger", "Lion", "Leopard", "Jaguar"]},
        {q: "Sushi origin?", a: "Japan", c: ["China", "Japan", "Korea", "Thailand"]},
        {q: "Brightest star?", a: "The Sun", c: ["Sirius", "The Sun", "Betelgeuse", "Polaris"]},
        {q: "Most islands country?", a: "Sweden", c: ["Indonesia", "Sweden", "Philippines", "Canada"]},
        {q: "Largest volcano?", a: "Mauna Loa", c: ["Kilauea", "Mauna Loa", "Vesuvius", "Fuji"]},
        {q: "Regrows its tail?", a: "Lizard", c: ["Frog", "Lizard", "Snake", "Salamander"]},
        {q: "Driest place on Earth?", a: "Atacama Desert", c: ["Death Valley", "Atacama Desert", "Sahara", "Antarctic"]},
        {q: "Longest coastline?", a: "Canada", c: ["Russia", "Canada", "Indonesia", "Norway"]},
        {q: "Sleeps standing?", a: "Horse", c: ["Cow", "Horse", "Giraffe", "Elephant"]},
        {q: "Most bridges city?", a: "Venice", c: ["Amsterdam", "Venice", "Hamburg", "Pittsburgh"]},
        {q: "Smallest ocean?", a: "Arctic", c: ["Indian", "Arctic", "Southern", "Atlantic"]},
        {q: "Chocolate origin?", a: "Mexico", c: ["Brazil", "Mexico", "Colombia", "Ghana"]},
        {q: "Largest lake?", a: "Caspian Sea", c: ["Superior", "Caspian Sea", "Victoria", "Huron"]},
        {q: "Three hearts animal?", a: "Octopus", c: ["Squid", "Octopus", "Cuttlefish", "Nautilus"]},
        {q: "Fastest fish?", a: "Sailfish", c: ["Marlin", "Sailfish", "Tuna", "Swordfish"]},
        {q: "Machu Picchu country?", a: "Peru", c: ["Bolivia", "Peru", "Ecuador", "Chile"]},
        {q: "Flies backwards?", a: "Hummingbird", c: ["Dragonfly", "Hummingbird", "Bee", "Wasp"]},
        {q: "Most spoken language?", a: "English", c: ["Mandarin", "English", "Spanish", "Hindi"]},
        {q: "Most time zones?", a: "France", c: ["Russia", "France", "USA", "Australia"]},
        {q: "Changes colors?", a: "Chameleon", c: ["Iguana", "Chameleon", "Gecko", "Anole"]},
        {q: "Highest waterfall?", a: "Angel Falls", c: ["Niagara", "Angel Falls", "Victoria", "Iguazu"]},
        {q: "Paper origin?", a: "China", c: ["Egypt", "China", "Mesopotamia", "Greece"]},
        {q: "Largest cat species?", a: "Tiger", c: ["Lion", "Tiger", "Jaguar", "Leopard"]},
        {q: "Most lakes country?", a: "Canada", c: ["Finland", "Canada", "Sweden", "Russia"]},
        {q: "Oldest city?", a: "Damascus", c: ["Jericho", "Damascus", "Athens", "Jerusalem"]},
        {q: "Most active volcanoes?", a: "Indonesia", c: ["Japan", "Indonesia", "Philippines", "Chile"]},
        {q: "Best memory animal?", a: "Elephant", c: ["Dolphin", "Elephant", "Chimpanzee", "Crow"]},
        {q: "Largest moon?", a: "Ganymede", c: ["Titan", "Ganymede", "Callisto", "Io"]},
        {q: "Ice cream origin?", a: "China", c: ["Italy", "China", "Persia", "Greece"]},
        {q: "Most abundant element?", a: "Hydrogen", c: ["Oxygen", "Hydrogen", "Carbon", "Nitrogen"]},
        {q: "Longest railway?", a: "Russia", c: ["China", "Russia", "USA", "Canada"]},
        {q: "Blue blood animal?", a: "Horseshoe Crab", c: ["Lobster", "Horseshoe Crab", "Octopus", "Squid"]},
        {q: "Strongest muscle?", a: "Jaw", c: ["Heart", "Jaw", "Tongue", "Glutes"]},
        {q: "Most coffee country?", a: "Finland", c: ["Italy", "Finland", "Brazil", "Turkey"]},
        {q: "Smallest bone?", a: "Stapes (ear)", c: ["Hyoid", "Stapes (ear)", "Clavicle", "Patella"]},
        {q: "Most moons planet?", a: "Saturn", c: ["Jupiter", "Saturn", "Uranus", "Neptune"]},
        {q: "Compass origin?", a: "China", c: ["Greece", "China", "Egypt", "Arabia"]},
        {q: "Largest living organism?", a: "Honey Fungus", c: ["Blue Whale", "Honey Fungus", "Giant Sequoia", "Coral Reef"]},
        {q: "Most bicycles?", a: "Netherlands", c: ["Denmark", "Netherlands", "China", "Germany"]},
        {q: "Rectangular pupils?", a: "Goat", c: ["Sheep", "Goat", "Horse", "Cow"]},
        {q: "Hardest natural substance?", a: "Diamond", c: ["Graphene", "Diamond", "Tungsten", "Titanium"]},
        {q: "Most castles?", a: "Germany", c: ["France", "Germany", "UK", "Spain"]},
        {q: "Survives in space?", a: "Tardigrade", c: ["Bacteria", "Tardigrade", "Virus", "Fungus"]},
        {q: "Largest flower?", a: "Rafflesia", c: ["Titan Arum", "Rafflesia", "Sunflower", "Lotus"]},
        {q: "Fireworks origin?", a: "China", c: ["India", "China", "Arabia", "Italy"]},
        {q: "Fastest growing plant?", a: "Bamboo", c: ["Kelp", "Bamboo", "Willow", "Kudzu"]},
        {q: "Fingerprints like humans?", a: "Koala", c: ["Gorilla", "Koala", "Chimpanzee", "Orangutan"]},
        {q: "Rarest blood type?", a: "Rh-null", c: ["AB-", "Rh-null", "O-", "Bombay"]},
        {q: "Deepest lake?", a: "Lake Baikal", c: ["Tanganyika", "Lake Baikal", "Malawi", "Crater Lake"]},
        {q: "Highest blood pressure?", a: "Giraffe", c: ["Elephant", "Giraffe", "Whale", "Rhino"]},
        {q: "Most diverse ecosystem?", a: "Brazil", c: ["Indonesia", "Brazil", "Congo", "Madagascar"]},
        {q: "Oldest board game?", a: "Senet", c: ["Go", "Senet", "Backgammon", "Chess"]},
        {q: "Most Nobel winners?", a: "United States", c: ["UK", "United States", "Germany", "France"]},
        {q: "Most chromosomes?", a: "Butterfly", c: ["Human", "Butterfly", "Potato", "Goldfish"]},
        {q: "Largest canyon?", a: "Grand Canyon", c: ["Fish River", "Grand Canyon", "Copper Canyon", "Yarlung Tsangpo"]},
        {q: "Wi-Fi origin?", a: "Australia", c: ["USA", "Australia", "Netherlands", "UK"]},
        {q: "Loudest animal?", a: "Sperm Whale", c: ["Blue Whale", "Sperm Whale", "Howler Monkey", "Elephant"]},
        {q: "Smallest mammal?", a: "Bumblebee Bat", c: ["Shrew", "Bumblebee Bat", "Mouse", "Hamster"]},
        {q: "Most internet users?", a: "China", c: ["India", "China", "USA", "Indonesia"]},
        {q: "Sleeps 3 years?", a: "Snail", c: ["Sloth", "Snail", "Turtle", "Hibernating Bear"]},
        {q: "Most expensive spice?", a: "Saffron", c: ["Vanilla", "Saffron", "Cardamom", "Cinnamon"]},
        {q: "Croissant origin?", a: "Austria", c: ["France", "Austria", "Italy", "Switzerland"]},
        {q: "Most venomous creature?", a: "Box Jellyfish", c: ["Cone Snail", "Box Jellyfish", "Blue Ring Octopus", "Inland Taipan"]},
        {q: "Most Olympic golds?", a: "United States", c: ["Russia", "United States", "China", "Germany"]},
        {q: "Rarest element?", a: "Astatine", c: ["Francium", "Astatine", "Promethium", "Technetium"]},
        {q: "Hottest planet?", a: "Venus", c: ["Mercury", "Venus", "Mars", "Jupiter"]},
        {q: "Fastest bird?", a: "Peregrine Falcon", c: ["Golden Eagle", "Peregrine Falcon", "Swift", "Albatross"]},
        {q: "Largest desert?", a: "Antarctic", c: ["Sahara", "Antarctic", "Arabian", "Gobi"]},
        {q: "Deepest point ocean?", a: "Challenger Deep", c: ["Milwaukee Deep", "Challenger Deep", "Java Trench", "Tonga Trench"]},
        {q: "Tallest building?", a: "Burj Khalifa", c: ["Shanghai Tower", "Burj Khalifa", "Merdeka 118", "One World Trade"]},
        {q: "Longest bone?", a: "Femur", c: ["Tibia", "Femur", "Humerus", "Fibula"]},
        {q: "Most spoken in China?", a: "Mandarin", c: ["Cantonese", "Mandarin", "Wu", "Min"]},
        {q: "Coldest temperature?", a: "Antarctica", c: ["Siberia", "Antarctica", "Greenland", "Alaska"]},
      ],
      medium: [
        {q: "Largest coral reef system?", a: "Great Barrier Reef", c: ["Belize Barrier", "Great Barrier Reef", "Red Sea Reef", "New Caledonia"]},
        {q: "Most densely populated?", a: "Monaco", c: ["Singapore", "Monaco", "Vatican City", "Bahrain"]},
        {q: "Invented the telephone?", a: "Alexander Graham Bell", c: ["Thomas Edison", "Alexander Graham Bell", "Nikola Tesla", "Guglielmo Marconi"]},
        {q: "Most UNESCO sites?", a: "Italy", c: ["China", "Italy", "Spain", "France"]},
        {q: "Largest organ?", a: "Skin", c: ["Liver", "Skin", "Brain", "Heart"]},
        {q: "Speed of light?", a: "299,792 km/s", c: ["300,000 km/s", "299,792 km/s", "186,000 mi/s", "299,999 km/s"]},
        {q: "Inventor of printing press?", a: "Johannes Gutenberg", c: ["Benjamin Franklin", "Johannes Gutenberg", "William Caxton", "Bi Sheng"]},
        {q: "Human body bones?", a: "206", c: ["198", "206", "214", "220"]},
        {q: "Longest English word?", a: "Pneumonoultramicroscopicsilicovolcanoconiosis", c: ["Antidisestablishmentarianism", "Pneumonoultramicroscopicsilicovolcanoconiosis", "Supercalifragilisticexpialidocious", "Floccinaucinihilipilification"]},
        {q: "Most populated city?", a: "Tokyo", c: ["Delhi", "Tokyo", "Shanghai", "SÃ£o Paulo"]},
        {q: "First artificial satellite?", a: "Sputnik 1", c: ["Explorer 1", "Sputnik 1", "Vanguard 1", "Luna 1"]},
        {q: "Human heart chambers?", a: "4", c: ["3", "4", "5", "6"]},
        {q: "Boiling point water?", a: "100Â°C", c: ["98Â°C", "100Â°C", "102Â°C", "212Â°F"]},
        {q: "Oldest university?", a: "University of Bologna", c: ["Oxford", "University of Bologna", "Paris", "Salamanca"]},
        {q: "Fastest helicopter?", a: "Westland Lynx", c: ["Apache", "Westland Lynx", "Chinook", "Black Hawk"]},
        {q: "Most expensive painting?", a: "Salvator Mundi", c: ["Mona Lisa", "Salvator Mundi", "The Scream", "Les Femmes d'Alger"]},
        {q: "Largest library?", a: "Library of Congress", c: ["British Library", "Library of Congress", "New York Public", "BibliothÃ¨que nationale"]},
        {q: "Invented the airplane?", a: "Wright Brothers", c: ["Santos-Dumont", "Wright Brothers", "Glenn Curtiss", "Otto Lilienthal"]},
        {q: "Most lightning strikes?", a: "Lake Maracaibo", c: ["Florida", "Lake Maracaibo", "Congo Basin", "Himalayas"]},
        {q: "Longest mountain range?", a: "Andes", c: ["Rockies", "Andes", "Himalayas", "Alps"]},
        {q: "Discovered penicillin?", a: "Alexander Fleming", c: ["Louis Pasteur", "Alexander Fleming", "Joseph Lister", "Robert Koch"]},
        {q: "Largest land animal?", a: "African Elephant", c: ["White Rhino", "African Elephant", "Hippo", "Giraffe"]},
        {q: "Most spoken language?", a: "Mandarin Chinese", c: ["English", "Mandarin Chinese", "Spanish", "Hindi"]},
        {q: "Longest recorded lifespan?", a: "Jeanne Calment", c: ["Sarah Knauss", "Jeanne Calment", "Kane Tanaka", "Jiroemon Kimura"]},
        {q: "Discovered gravity?", a: "Isaac Newton", c: ["Galileo", "Isaac Newton", "Einstein", "Kepler"]},
        {q: "Most abundant gas?", a: "Nitrogen", c: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Argon"]},
        {q: "Largest spider?", a: "Goliath Birdeater", c: ["Huntsman", "Goliath Birdeater", "Tarantula", "Camel Spider"]},
        {q: "Painted Mona Lisa?", a: "Leonardo da Vinci", c: ["Michelangelo", "Leonardo da Vinci", "Raphael", "Botticelli"]},
        {q: "Deepest diving mammal?", a: "Cuvier's Beaked Whale", c: ["Sperm Whale", "Cuvier's Beaked Whale", "Elephant Seal", "Bottlenose Dolphin"]},
        {q: "Largest dinosaur?", a: "Argentinosaurus", c: ["Brachiosaurus", "Argentinosaurus", "Diplodocus", "T-Rex"]},
        {q: "Invented the Internet?", a: "Multiple Scientists", c: ["Bill Gates", "Multiple Scientists", "Steve Jobs", "Tim Berners-Lee"]},
        {q: "Human body elements?", a: "Oxygen", c: ["Carbon", "Oxygen", "Hydrogen", "Nitrogen"]},
        {q: "Longest cave system?", a: "Mammoth Cave", c: ["Carlsbad Caverns", "Mammoth Cave", "Jewel Cave", "Wind Cave"]},
        {q: "Discovered DNA structure?", a: "Watson & Crick", c: ["Mendel", "Watson & Crick", "Franklin", "Linus Pauling"]},
        {q: "Largest flying bird?", a: "Wandering Albatross", c: ["Condor", "Wandering Albatross", "Pelican", "Swan"]},
        {q: "Most venomous snake?", a: "Inland Taipan", c: ["King Cobra", "Inland Taipan", "Black Mamba", "Death Adder"]},
        {q: "Wrote Romeo & Juliet?", a: "William Shakespeare", c: ["Christopher Marlowe", "William Shakespeare", "Ben Jonson", "John Milton"]},
        {q: "Fastest marine mammal?", a: "Orca", c: ["Dolphin", "Orca", "Seal", "Whale"]},
        {q: "Largest tree by volume?", a: "General Sherman", c: ["Hyperion", "General Sherman", "Stratosphere Giant", "Helios"]},
        {q: "Discovered America?", a: "Leif Erikson", c: ["Columbus", "Leif Erikson", "Amerigo Vespucci", "Magellan"]},
        {q: "Smallest planet?", a: "Mercury", c: ["Mars", "Mercury", "Pluto", "Venus"]},
        {q: "Longest river in Asia?", a: "Yangtze", c: ["Ganges", "Yangtze", "Mekong", "Yellow River"]},
        {q: "Painted The Starry Night?", a: "Vincent van Gogh", c: ["Monet", "Vincent van Gogh", "Renoir", "Degas"]},
        {q: "Largest butterfly?", a: "Queen Alexandra's Birdwing", c: ["Monarch", "Queen Alexandra's Birdwing", "Atlas Moth", "Morpho"]},
        {q: "Discovered X-rays?", a: "Wilhelm RÃ¶ntgen", c: ["Marie Curie", "Wilhelm RÃ¶ntgen", "Henri Becquerel", "Ernest Rutherford"]},
        {q: "Most abundant metal?", a: "Aluminum", c: ["Iron", "Aluminum", "Copper", "Gold"]},
        {q: "Longest lived animal?", a: "Ocean Quahog", c: ["Tortoise", "Ocean Quahog", "Greenland Shark", "Bowhead Whale"]},
        {q: "Wrote 1984?", a: "George Orwell", c: ["Aldous Huxley", "George Orwell", "Ray Bradbury", "Kurt Vonnegut"]},
        {q: "Largest sea?", a: "Philippine Sea", c: ["Caribbean", "Philippine Sea", "Mediterranean", "South China Sea"]},
        {q: "Discovered electrons?", a: "J.J. Thomson", c: ["Einstein", "J.J. Thomson", "Bohr", "Rutherford"]},
        {q: "Most poisonous plant?", a: "Castor Bean", c: ["Nightshade", "Castor Bean", "Hemlock", "Oleander"]},
        {q: "Wrote Hamlet?", a: "William Shakespeare", c: ["Christopher Marlowe", "William Shakespeare", "Ben Jonson", "Thomas Kyd"]},
        {q: "Largest carnivore?", a: "Southern Elephant Seal", c: ["Polar Bear", "Southern Elephant Seal", "Saltwater Croc", "Kodiak Bear"]},
        {q: "Discovered radioactivity?", a: "Henri Becquerel", c: ["Marie Curie", "Henri Becquerel", "Pierre Curie", "Rutherford"]},
        {q: "Longest insect?", a: "Chan's Megastick", c: ["Walking Stick", "Chan's Megastick", "Atlas Beetle", "Goliath Beetle"]},
        {q: "Painted The Scream?", a: "Edvard Munch", c: ["Van Gogh", "Edvard Munch", "Klimt", "Kandinsky"]},
        {q: "Most precious metal?", a: "Rhodium", c: ["Gold", "Rhodium", "Platinum", "Palladium"]},
        {q: "Wrote Moby Dick?", a: "Herman Melville", c: ["Mark Twain", "Herman Melville", "Jack London", "Edgar Allan Poe"]},
        {q: "Largest rodent?", a: "Capybara", c: ["Beaver", "Capybara", "Porcupine", "Muskrat"]},
        {q: "Discovered Neptune?", a: "Johann Galle", c: ["Galileo", "Johann Galle", "Herschel", "Tycho"]},
        {q: "Most radioactive element?", a: "Polonium", c: ["Uranium", "Polonium", "Radium", "Plutonium"]},
        {q: "Wrote The Odyssey?", a: "Homer", c: ["Virgil", "Homer", "Sophocles", "Euripides"]},
        {q: "Largest crocodile species?", a: "Saltwater Crocodile", c: ["Nile Croc", "Saltwater Crocodile", "American Croc", "Orinoco Croc"]},
        {q: "Discovered Uranus?", a: "William Herschel", c: ["Galileo", "William Herschel", "Newton", "Kepler"]},
        {q: "Most powerful microscope?", a: "Electron Microscope", c: ["Light", "Electron Microscope", "Scanning Probe", "Confocal"]},
        {q: "Wrote Pride and Prejudice?", a: "Jane Austen", c: ["BrontÃ«", "Jane Austen", "George Eliot", "Edith Wharton"]},
        {q: "Largest penguin?", a: "Emperor Penguin", c: ["King Penguin", "Emperor Penguin", "Gentoo", "Macaroni"]},
        {q: "Discovered evolution?", a: "Charles Darwin", c: ["Lamarck", "Charles Darwin", "Wallace", "Mendel"]},
        {q: "Highest IQ recorded?", a: "Marilyn vos Savant", c: ["Einstein", "Marilyn vos Savant", "Stephen Hawking", "Terence Tao"]},
        {q: "Wrote War and Peace?", a: "Leo Tolstoy", c: ["Dostoyevsky", "Leo Tolstoy", "Turgenev", "Chekhov"]},
        {q: "Largest bird egg?", a: "Ostrich", c: ["Emu", "Ostrich", "Cassowary", "Rhea"]},
        {q: "Discovered bacteria?", a: "Antonie van Leeuwenhoek", c: ["Pasteur", "Antonie van Leeuwenhoek", "Koch", "Fleming"]},
        {q: "Most expensive gemstone?", a: "Pink Star Diamond", c: ["Hope Diamond", "Pink Star Diamond", "Blue Moon", "Koh-i-Noor"]},
        {q: "Wrote Don Quixote?", a: "Miguel de Cervantes", c: ["Lope de Vega", "Miguel de Cervantes", "CalderÃ³n", "GÃ³ngora"]},
        {q: "Largest seal?", a: "Southern Elephant Seal", c: ["Walrus", "Southern Elephant Seal", "Leopard Seal", "Weddell Seal"]},
        {q: "Discovered photosynthesis?", a: "Jan Ingenhousz", c: ["Priestley", "Jan Ingenhousz", "Lavoisier", "Senebier"]},
        {q: "Most conductive element?", a: "Silver", c: ["Copper", "Silver", "Gold", "Aluminum"]},
        {q: "Wrote Frankenstein?", a: "Mary Shelley", c: ["Bram Stoker", "Mary Shelley", "Edgar Allan Poe", "H.G. Wells"]},
        {q: "Largest amphibian?", a: "Chinese Giant Salamander", c: ["Japanese Salamander", "Chinese Giant Salamander", "Goliath Frog", "African Bullfrog"]},
        {q: "Discovered electromagnetic induction?", a: "Michael Faraday", c: ["Volta", "Michael Faraday", "Ampere", "Ohm"]},
        {q: "Most reflective metal?", a: "Silver", c: ["Aluminum", "Silver", "Platinum", "Chrome"]},
        {q: "Wrote The Great Gatsby?", a: "F. Scott Fitzgerald", c: ["Hemingway", "F. Scott Fitzgerald", "Faulkner", "Steinbeck"]},
        {q: "Largest jellyfish?", a: "Lion's Mane", c: ["Portuguese Man o' War", "Lion's Mane", "Box Jellyfish", "Moon Jelly"]},
        {q: "Discovered laws of motion?", a: "Isaac Newton", c: ["Galileo", "Isaac Newton", "Kepler", "Einstein"]},
        {q: "Most malleable metal?", a: "Gold", c: ["Silver", "Gold", "Copper", "Aluminum"]},
        {q: "Wrote To Kill a Mockingbird?", a: "Harper Lee", c: ["Steinbeck", "Harper Lee", "Faulkner", "Tennessee Williams"]},
        {q: "Largest primate?", a: "Eastern Gorilla", c: ["Western Gorilla", "Eastern Gorilla", "Orangutan", "Chimpanzee"]},
        {q: "Discovered circulation?", a: "William Harvey", c: ["Galen", "William Harvey", "Vesalius", "Malpighi"]},
        {q: "Most ductile metal?", a: "Gold", c: ["Platinum", "Gold", "Silver", "Copper"]},
        {q: "Wrote The Catcher in the Rye?", a: "J.D. Salinger", c: ["Kerouac", "J.D. Salinger", "Vonnegut", "Heller"]},
        {q: "Largest snake?", a: "Green Anaconda", c: ["Reticulated Python", "Green Anaconda", "Burmese Python", "King Cobra"]},
        {q: "Discovered Neptune's moon?", a: "William Lassell", c: ["Herschel", "William Lassell", "Galle", "Kuiper"]},
        {q: "Most heat-resistant metal?", a: "Tungsten", c: ["Titanium", "Tungsten", "Molybdenum", "Tantalum"]},
        {q: "Wrote Brave New World?", a: "Aldous Huxley", c: ["Orwell", "Aldous Huxley", "Bradbury", "Zamyatin"]},
        {q: "Largest frog?", a: "Goliath Frog", c: ["African Bullfrog", "Goliath Frog", "Cane Toad", "Marine Toad"]},
        {q: "Discovered infrared radiation?", a: "William Herschel", c: ["Newton", "William Herschel", "Young", "Maxwell"]},
      ],
      hard: [
        {q: "Quantum superposition?", a: "Multiple states", c: ["Single state", "Multiple states", "No state", "Wave collapse"]},
        {q: "Planck constant value?", a: "6.626 Ã— 10â»Â³â´", c: ["6.022 Ã— 10Â²Â³", "6.626 Ã— 10â»Â³â´", "9.109 Ã— 10â»Â³Â¹", "1.380 Ã— 10â»Â²Â³"]},
        {q: "Riemann Hypothesis field?", a: "Number Theory", c: ["Topology", "Number Theory", "Algebra", "Analysis"]},
        {q: "GÃ¶del's incompleteness year?", a: "1931", c: ["1905", "1931", "1945", "1921"]},
        {q: "Shannon entropy unit?", a: "Bits", c: ["Nats", "Bits", "Bans", "Hartleys"]},
        {q: "Noether's theorem relates?", a: "Symmetry & Conservation", c: ["Energy & Mass", "Symmetry & Conservation", "Space & Time", "Force & Motion"]},
        {q: "P vs NP problem field?", a: "Computer Science", c: ["Mathematics", "Computer Science", "Physics", "Logic"]},
        {q: "Heisenberg uncertainty relates?", a: "Position & Momentum", c: ["Energy & Time", "Position & Momentum", "Spin & Charge", "Mass & Velocity"]},
        {q: "Fermat's Last Theorem proved?", a: "1995", c: ["1963", "1995", "2001", "1987"]},
        {q: "Mandelbrot set dimension?", a: "Fractal", c: ["Integer", "Fractal", "Irrational", "Complex"]},
        {q: "Standard Model particles?", a: "17", c: ["12", "17", "23", "31"]},
        {q: "SchrÃ¶dinger equation type?", a: "Wave equation", c: ["Differential", "Wave equation", "Algebraic", "Integral"]},
        {q: "Euler's identity relates?", a: "e, Ï€, i", c: ["Ï†, e, i", "e, Ï€, i", "Ï€, Ï†, e", "i, e, Ï†"]},
        {q: "Nash equilibrium field?", a: "Game Theory", c: ["Economics", "Game Theory", "Mathematics", "Strategy"]},
        {q: "Turing test measures?", a: "Machine Intelligence", c: ["Processing Speed", "Machine Intelligence", "Memory Capacity", "Algorithm Efficiency"]},
        {q: "Hawking radiation from?", a: "Black Holes", c: ["Stars", "Black Holes", "Neutron Stars", "Quasars"]},
        {q: "Fibonacci sequence type?", a: "Recursive", c: ["Arithmetic", "Recursive", "Geometric", "Harmonic"]},
        {q: "Bell's theorem proves?", a: "Quantum Entanglement", c: ["Hidden Variables", "Quantum Entanglement", "Wave Function", "Superposition"]},
        {q: "Collatz conjecture field?", a: "Number Theory", c: ["Algebra", "Number Theory", "Topology", "Analysis"]},
        {q: "Navier-Stokes equation?", a: "Fluid Dynamics", c: ["Thermodynamics", "Fluid Dynamics", "Quantum Mechanics", "Relativity"]},
        {q: "Cantor set property?", a: "Perfect & Nowhere Dense", c: ["Complete", "Perfect & Nowhere Dense", "Compact", "Connected"]},
        {q: "Goldbach conjecture about?", a: "Prime Numbers", c: ["Composite Numbers", "Prime Numbers", "Perfect Numbers", "Twin Primes"]},
        {q: "Lorentz transformation?", a: "Special Relativity", c: ["General Relativity", "Special Relativity", "Quantum Theory", "Classical Mechanics"]},
        {q: "Hilbert's 23 problems year?", a: "1900", c: ["1890", "1900", "1910", "1920"]},
        {q: "Dirac equation combines?", a: "QM & Relativity", c: ["Classical & QM", "QM & Relativity", "Gravity & QM", "EM & Gravity"]},
        {q: "Arrow's impossibility?", a: "Voting Systems", c: ["Economics", "Voting Systems", "Game Theory", "Decision Theory"]},
        {q: "PoincarÃ© conjecture?", a: "Topology", c: ["Geometry", "Topology", "Algebra", "Analysis"]},
        {q: "Yang-Mills theory field?", a: "Gauge Theory", c: ["String Theory", "Gauge Theory", "QCD", "Electroweak"]},
        {q: "Fourier transform domain?", a: "Frequency", c: ["Time", "Frequency", "Space", "Phase"]},
        {q: "Bayesian inference uses?", a: "Prior Probability", c: ["Frequency", "Prior Probability", "Likelihood", "Sample Size"]},
        {q: "Chaos theory sensitivity?", a: "Initial Conditions", c: ["Final States", "Initial Conditions", "Boundary Conditions", "Parameters"]},
        {q: "Ramsey theory field?", a: "Combinatorics", c: ["Graph Theory", "Combinatorics", "Number Theory", "Topology"]},
        {q: "Boltzmann constant unit?", a: "J/K", c: ["JÂ·s", "J/K", "kgÂ·mÂ²/sÂ²", "NÂ·m"]},
        {q: "Hodge conjecture relates?", a: "Algebraic Cycles", c: ["Topological Spaces", "Algebraic Cycles", "Differential Forms", "Complex Varieties"]},
        {q: "Kaluza-Klein theory?", a: "Extra Dimensions", c: ["String Theory", "Extra Dimensions", "Quantum Gravity", "Grand Unification"]},
        {q: "Grothendieck's contribution?", a: "Algebraic Geometry", c: ["Number Theory", "Algebraic Geometry", "Topology", "Analysis"]},
        {q: "Church-Turing thesis?", a: "Computability", c: ["Decidability", "Computability", "Complexity", "Recursion"]},
        {q: "Schwarz inequality field?", a: "Linear Algebra", c: ["Calculus", "Linear Algebra", "Analysis", "Geometry"]},
        {q: "Birch and Swinnerton-Dyer?", a: "Elliptic Curves", c: ["Modular Forms", "Elliptic Curves", "Abelian Varieties", "Diophantine Equations"]},
        {q: "Wiles proved?", a: "Fermat's Last Theorem", c: ["Riemann Hypothesis", "Fermat's Last Theorem", "Goldbach Conjecture", "Twin Prime"]},
        {q: "Banach-Tarski paradox?", a: "Decomposition", c: ["Integration", "Decomposition", "Differentiation", "Transformation"]},
        {q: "Gromov-Witten invariants?", a: "Symplectic Geometry", c: ["Riemannian Geometry", "Symplectic Geometry", "Algebraic Topology", "Differential Geometry"]},
        {q: "Langlands program connects?", a: "Number Theory & Representation", c: ["Algebra & Topology", "Number Theory & Representation", "Analysis & Geometry", "Logic & Computability"]},
        {q: "Atiyah-Singer index?", a: "Differential Operators", c: ["Algebraic Varieties", "Differential Operators", "Topological Spaces", "Manifolds"]},
        {q: "Seiberg-Witten theory?", a: "4-Manifolds", c: ["3-Manifolds", "4-Manifolds", "5-Manifolds", "6-Manifolds"]},
        {q: "Perelman solved?", a: "PoincarÃ© Conjecture", c: ["Riemann Hypothesis", "PoincarÃ© Conjecture", "P vs NP", "Hodge Conjecture"]},
        {q: "Witten's M-theory?", a: "11 Dimensions", c: ["10 Dimensions", "11 Dimensions", "12 Dimensions", "26 Dimensions"]},
        {q: "Donaldson invariants?", a: "4-Manifolds", c: ["3-Manifolds", "4-Manifolds", "5-Manifolds", "Complex Manifolds"]},
        {q: "Thurston geometrization?", a: "3-Manifolds", c: ["2-Manifolds", "3-Manifolds", "4-Manifolds", "Hyperbolic Spaces"]},
        {q: "Taniyama-Shimura conjecture?", a: "Elliptic Curves & Modular Forms", c: ["Abelian Varieties", "Elliptic Curves & Modular Forms", "Automorphic Forms", "L-functions"]},
        {q: "Connes noncommutative?", a: "Geometry", c: ["Algebra", "Geometry", "Topology", "Analysis"]},
      ]
    };

    // Generate 300 puzzles with randomization within tiers
    const generateAllPuzzles = () => {
      const puzzles = [];
      let id = 1;
      
      // Easy tier (1-100): 3x3 and 4x4, CROSS pattern
      for(let i = 0; i < 100; i++) {
        const size = i < 50 ? 3 : 4;
        const row = Math.floor(Math.random() * size);
        const col = Math.floor(Math.random() * size);
        const trivia = ALL_TRIVIA.easy[i % ALL_TRIVIA.easy.length];
        puzzles.push(generatePuzzle(id++, size, row, col, trivia, FLIP_PATTERNS.CROSS));
      }
      
      // Medium tier (101-200): 4x4 and 5x5, varied patterns
      const mediumPatterns = [FLIP_PATTERNS.CROSS, FLIP_PATTERNS.X_PATTERN, FLIP_PATTERNS.L_SHAPE];
      for(let i = 0; i < 100; i++) {
        const size = i < 50 ? 4 : 5;
        const row = Math.floor(Math.random() * size);
        const col = Math.floor(Math.random() * size);
        const pattern = mediumPatterns[Math.floor(Math.random() * mediumPatterns.length)];
        const trivia = ALL_TRIVIA.medium[i % ALL_TRIVIA.medium.length];
        puzzles.push(generatePuzzle(id++, size, row, col, trivia, pattern));
      }
      
      // Hard tier (201-300): 5x5 and 6x6, all patterns
      const allPatterns = Object.values(FLIP_PATTERNS);
      for(let i = 0; i < 100; i++) {
        const size = i < 50 ? 5 : 6;
        const row = Math.floor(Math.random() * size);
        const col = Math.floor(Math.random() * size);
        const pattern = allPatterns[Math.floor(Math.random() * allPatterns.length)];
        const trivia = ALL_TRIVIA.hard[i % ALL_TRIVIA.hard.length];
        puzzles.push(generatePuzzle(id++, size, row, col, trivia, pattern));
      }
      
      return puzzles;
    };

    // Shuffle array within tiers
    const shuffleWithinTiers = (puzzles) => {
      const tier1 = puzzles.slice(0, 100);
      const tier2 = puzzles.slice(100, 200);
      const tier3 = puzzles.slice(200, 300);
      
      const shuffle = (array) => {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      };
      
      return [...shuffle(tier1), ...shuffle(tier2), ...shuffle(tier3)];
    };

    // Reward milestones
    const MILESTONES = [
      { at: 50, title: "Pattern Seeker", message: "You're beginning to see the patterns!" },
      { at: 100, title: "Logic Master", message: "Your logical mind is sharp!" },
      { at: 150, title: "Mind Bender", message: "You're bending puzzles to your will!" },
      { at: 200, title: "Puzzle Architect", message: "You build solutions like a pro!" },
      { at: 250, title: "The Persistent", message: "Your persistence is unmatched!" },
      { at: 300, title: "ONE MOVE Master", message: "You've achieved mastery!" }
    ];

    const OneMove = () => {
      const [screen, setScreen] = useState('home');
      const [puzzles, setPuzzles] = useState([]);
      const [currentPuzzleIndex, setCurrentPuzzleIndex] = useState(0);
      const [grid, setGrid] = useState([]);
      const [triviaScore, setTriviaScore] = useState(0);
      const [puzzleScore, setPuzzleScore] = useState(0);
      const [processing, setProcessing] = useState(false);
      const [selectedAnswer, setSelectedAnswer] = useState(null);
      const [showResult, setShowResult] = useState(false);
      const [currentTitle, setCurrentTitle] = useState("");
      const [showMilestone, setShowMilestone] = useState(false);
      const [milestoneData, setMilestoneData] = useState(null);
      const [uniqueCode, setUniqueCode] = useState("");
      const [shuffledChoices, setShuffledChoices] = useState([]);

      // Load/save progress
      useEffect(() => {
        const saved = localStorage.getItem('oneMoveSave');
        if (saved) {
          const data = JSON.parse(saved);
          setPuzzles(data.puzzles || []);
          setCurrentPuzzleIndex(data.currentIndex || 0);
          setTriviaScore(data.triviaScore || 0);
          setPuzzleScore(data.puzzleScore || 0);
          setCurrentTitle(data.currentTitle || "");
          setUniqueCode(data.uniqueCode || generateUniqueCode());
        } else {
          setUniqueCode(generateUniqueCode());
        }
      }, []);

      const saveProgress = (data) => {
        localStorage.setItem('oneMoveSave', JSON.stringify({
          puzzles,
          currentIndex: currentPuzzleIndex,
          triviaScore,
          puzzleScore,
          currentTitle,
          uniqueCode,
          ...data
        }));
      };

      const generateUniqueCode = () => {
        return 'OM-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      };

      const currentPuzzle = puzzles[currentPuzzleIndex];

      // Shuffle answer choices
      useEffect(() => {
        if (currentPuzzle && screen === 'trivia') {
          const choices = [...currentPuzzle.trivia.c];
          for (let i = choices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [choices[i], choices[j]] = [choices[j], choices[i]];
          }
          setShuffledChoices(choices);
        }
      }, [currentPuzzle, screen]);

      const playSound = (type) => {
        try {
          const AudioContextClass = window.AudioContext || window.webkitAudioContext;
          if (!AudioContextClass) return;
          const audioContext = new AudioContextClass();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          if (type === 'flip') {
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
          } else if (type === 'success') {
            oscillator.frequency.value = 523.25;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
          }
        } catch (error) {}
      };

      const handleAnswerSelect = (answer) => {
        setSelectedAnswer(answer);
        setShowResult(true);
        
        if (answer === currentPuzzle.trivia.a) {
          playSound('success');
          const newTriviaScore = triviaScore + 1;
          setTriviaScore(newTriviaScore);
          saveProgress({ triviaScore: newTriviaScore });
          
          setTimeout(() => {
            setShowResult(false);
            setSelectedAnswer(null);
            setGrid(currentPuzzle.grid.map(row => [...row]));
            setScreen('puzzle');
          }, 2000);
        } else {
          setTimeout(() => {
            setShowResult(false);
            setSelectedAnswer(null);
          }, 2000);
        }
      };

      const applyFlipPattern = (row, col, gridCopy, pattern) => {
        const flip = (r, c) => {
          if (r >= 0 && r < gridCopy.length && c >= 0 && c < gridCopy[0].length) {
            gridCopy[r][c] = gridCopy[r][c] === 1 ? 0 : 1;
          }
        };
        
        flip(row, col);
        
        switch(pattern) {
          case FLIP_PATTERNS.CROSS:
            flip(row - 1, col);
            flip(row + 1, col);
            flip(row, col - 1);
            flip(row, col + 1);
            break;
          case FLIP_PATTERNS.X_PATTERN:
            flip(row - 1, col - 1);
            flip(row - 1, col + 1);
            flip(row + 1, col - 1);
            flip(row + 1, col + 1);
            break;
          case FLIP_PATTERNS.SQUARE:
            for(let dr = -1; dr <= 1; dr++) {
              for(let dc = -1; dc <= 1; dc++) {
                if(dr !== 0 || dc !== 0) flip(row + dr, col + dc);
              }
            }
            break;
          case FLIP_PATTERNS.L_SHAPE:
            flip(row - 1, col);
            flip(row, col + 1);
            break;
          case FLIP_PATTERNS.LINE_H:
            flip(row, col - 1);
            flip(row, col + 1);
            break;
          case FLIP_PATTERNS.LINE_V:
            flip(row - 1, col);
            flip(row + 1, col);
            break;
        }
      };

      const handleTileTap = async (row, col) => {
        if (processing) return;
        setProcessing(true);
        
        const newGrid = grid.map(r => [...r]);
        applyFlipPattern(row, col, newGrid, currentPuzzle.pattern);
        
        playSound('flip');
        setGrid(newGrid);
        
        await new Promise(resolve => setTimeout(resolve, 800));
        const isSolved = newGrid.every(row => row.every(tile => tile === 1));
        
        if (isSolved) {
          playSound('success');
          const newPuzzleScore = puzzleScore + 1;
          setPuzzleScore(newPuzzleScore);
          setScreen('success');
          
          // Check for milestone
          const milestone = MILESTONES.find(m => m.at === newPuzzleScore);
          if (milestone) {
            setMilestoneData(milestone);
            setCurrentTitle(milestone.title);
            saveProgress({ puzzleScore: newPuzzleScore, currentTitle: milestone.title });
            
            setTimeout(() => {
              setScreen('milestone');
              setProcessing(false);
            }, 2500);
          } else {
            saveProgress({ puzzleScore: newPuzzleScore });
            setTimeout(() => {
              if (currentPuzzleIndex < puzzles.length - 1) {
                const newIndex = currentPuzzleIndex + 1;
                setCurrentPuzzleIndex(newIndex);
                saveProgress({ currentIndex: newIndex, puzzleScore: newPuzzleScore });
                setScreen('trivia');
              } else {
                setScreen('complete');
              }
              setProcessing(false);
            }, 2500);
          }
        } else {
          setProcessing(false);
        }
      };

      const handlePlay = () => {
        const newPuzzles = shuffleWithinTiers(generateAllPuzzles());
        setPuzzles(newPuzzles);
        setScreen('trivia');
        setCurrentPuzzleIndex(0);
        setTriviaScore(0);
        setPuzzleScore(0);
        setCurrentTitle("");
        saveProgress({ 
          puzzles: newPuzzles, 
          currentIndex: 0, 
          triviaScore: 0, 
          puzzleScore: 0, 
          currentTitle: "" 
        });
      };

      const handleContinue = () => {
        setScreen('trivia');
      };

      const handleMilestoneContinue = () => {
        if (currentPuzzleIndex < puzzles.length - 1) {
          setCurrentPuzzleIndex(prev => prev + 1);
          setScreen('trivia');
        } else {
          setScreen('complete');
        }
      };

      // Home Screen
      if (screen === 'home') {
        const hasSavedProgress = puzzles.length > 0 && currentPuzzleIndex > 0;
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
            <div className="text-center space-y-8 max-w-md">
              <h1 className="text-6xl font-extralight text-white tracking-wider mb-8">
                ONE MOVE
              </h1>
              
              <div className="bg-slate-800/50 rounded-xl p-6 text-left space-y-4 border border-slate-700">
                <h2 className="text-xl font-light text-white mb-4">How to Play:</h2>
                <div className="space-y-3 text-slate-300 text-sm leading-relaxed">
                  <p><span className="text-blue-400 font-semibold">1.</span> Answer trivia questions (multiple choice)</p>
                  <p><span className="text-blue-400 font-semibold">2.</span> Solve the puzzle in ONE tap</p>
                  <p><span className="text-blue-400 font-semibold">3.</span> When you tap a tile, it changes colorâ€”AND so do nearby tiles</p>
                  <p><span className="text-blue-400 font-semibold">4.</span> Goal: Make all tiles blue</p>
                  <p className="text-xs text-slate-400 pt-2">Pattern changes as you progressâ€”stay sharp!</p>
                </div>
              </div>
              
              <div className="space-y-4">
                <button
                  onClick={handlePlay}
                  className="w-full px-12 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 flex items-center justify-center gap-3 text-lg font-light tracking-wide"
                >
                  <Play className="w-5 h-5" />
                  <span>{hasSavedProgress ? 'New Game' : 'Play'}</span>
                </button>
                
                {hasSavedProgress && (
                  <button
                    onClick={handleContinue}
                    className="w-full px-12 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all duration-300 text-lg font-light tracking-wide"
                  >
                    Continue ({puzzleScore}/300)
                  </button>
                )}
              </div>
              
              {currentTitle && (
                <div className="text-slate-400 text-sm">
                  Current Title: <span className="text-blue-400">{currentTitle}</span>
                </div>
              )}
            </div>
          </div>
        );
      }

      // Trivia Screen
      if (screen === 'trivia' && currentPuzzle) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
            <div className="absolute top-4 right-4 space-y-2">
              <div className="bg-green-600 px-3 py-1.5 rounded-lg text-right">
                <div className="text-white text-xs font-semibold">
                  âœ“ TRIVIA: {triviaScore}/300
                </div>
              </div>
              <div className="bg-blue-600 px-3 py-1.5 rounded-lg text-right">
                <div className="text-white text-xs font-semibold">
                  ðŸ§© PUZZLES: {puzzleScore}/300
                </div>
              </div>
            </div>
            
            <div className="max-w-2xl w-full space-y-8 mt-16">
              <div className="text-center">
                <div className="text-slate-500 text-sm mb-2">Question {currentPuzzleIndex + 1} of 300</div>
                <h2 className="text-3xl font-light text-white mb-8">
                  {currentPuzzle.trivia.q}
                </h2>
              </div>
              
              <div className="grid grid-cols-1 gap-4">
                {shuffledChoices.map((choice, index) => (
                  <button
                    key={index}
                    onClick={() => !showResult && handleAnswerSelect(choice)}
                    disabled={showResult}
                    className={`
                      p-6 rounded-xl text-lg font-light transition-all duration-300
                      ${showResult && choice === selectedAnswer && choice === currentPuzzle.trivia.a
                        ? 'bg-green-600 text-white scale-105'
                        : showResult && choice === selectedAnswer && choice !== currentPuzzle.trivia.a
                        ? 'bg-red-600 text-white'
                        : showResult
                        ? 'bg-slate-800/30 text-slate-500 cursor-not-allowed'
                        : 'bg-slate-800/50 text-white hover:bg-slate-700/50 border border-slate-700 hover:border-blue-500'
                      }
                    `}
                  >
                    {choice}
                  </button>
                ))}
              </div>
              
              {showResult && selectedAnswer === currentPuzzle.trivia.a && (
                <div className="text-center text-2xl font-light text-green-400 animate-pulse">
                  Correct! âœ“
                </div>
              )}
              
              {showResult && selectedAnswer !== currentPuzzle.trivia.a && (
                <div className="text-center space-y-2">
                  <div className="text-2xl font-light text-red-400 animate-pulse">
                    Not quite!
                  </div>
                  <div className="text-sm text-slate-400">
                    Try again or choose another answer
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      // Puzzle Screen
      if (screen === 'puzzle' && currentPuzzle) {
        const gridSize = currentPuzzle.gridSize;
        const tileSize = gridSize === 3 ? 'w-24 h-24' : gridSize === 4 ? 'w-20 h-20' : gridSize === 5 ? 'w-16 h-16' : 'w-14 h-14';
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
            <div className="absolute top-4 right-4 space-y-2">
              <div className="bg-green-600 px-3 py-1.5 rounded-lg text-right">
                <div className="text-white text-xs font-semibold">
                  âœ“ TRIVIA: {triviaScore}/300
                </div>
              </div>
              <div className="bg-blue-600 px-3 py-1.5 rounded-lg text-right">
                <div className="text-white text-xs font-semibold">
                  ðŸ§© PUZZLES: {puzzleScore}/300
                </div>
              </div>
            </div>
            
            <div className="space-y-8">
              <div className="text-center">
                <p className="text-white text-lg font-light">Find the ONE move!</p>
                <p className="text-slate-400 text-sm mt-2">Puzzle {currentPuzzleIndex + 1} of 300</p>
              </div>
              
              <div 
                className="inline-grid gap-2 p-6 bg-slate-800/30 rounded-2xl backdrop-blur-sm"
                style={{ gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))` }}
              >
                {grid.map((row, rowIndex) => (
                  row.map((tile, colIndex) => (
                    <button
                      key={`${rowIndex}-${colIndex}`}
                      onClick={() => handleTileTap(rowIndex, colIndex)}
                      disabled={processing}
                      className={`
                        ${tileSize}
                        rounded-lg
                        transition-all duration-300
                        ${tile === 1 
                          ? 'bg-gradient-to-br from-blue-400 to-blue-600 shadow-lg shadow-blue-500/50 hover:shadow-blue-500/70 hover:scale-105' 
                          : 'bg-slate-800 border-2 border-slate-700'
                        }
                        ${processing ? 'cursor-not-allowed' : 'cursor-pointer'}
                      `}
                    />
                  ))
                ))}
              </div>
            </div>
          </div>
        );
      }

      // Success Screen
      if (screen === 'success' && currentPuzzle) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
            <div className="text-center space-y-8">
              <h2 className="text-5xl font-extralight text-white tracking-wider">
                Solved! âœ“
              </h2>
              
              <div className="max-w-md mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                <p className="text-slate-400 text-sm font-light mb-2">
                  {currentPuzzle.trivia.q}
                </p>
                <p className="text-white text-2xl font-light">
                  {currentPuzzle.trivia.a}
                </p>
              </div>
            </div>
          </div>
        );
      }

      // Milestone Screen
      if (screen === 'milestone' && milestoneData) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 flex items-center justify-center p-6">
            <div className="text-center space-y-8 max-w-md">
              <div className="flex justify-center">
                <Trophy className="w-24 h-24 text-yellow-400 animate-pulse" />
              </div>
              
              <div>
                <h2 className="text-4xl font-extralight text-white tracking-wider mb-4">
                  Title Unlocked!
                </h2>
                <p className="text-3xl font-light text-yellow-400 mb-4">
                  {milestoneData.title}
                </p>
                <p className="text-slate-300 text-lg">
                  {milestoneData.message}
                </p>
              </div>
              
              <div className="bg-slate-800/50 rounded-xl p-6 border border-yellow-400/30">
                <div className="text-slate-400 text-sm mb-2">Your Progress</div>
                <div className="space-y-2">
                  <div className="text-white text-lg">
                    âœ“ Trivia: {triviaScore}/300
                  </div>
                  <div className="text-white text-lg">
                    ðŸ§© Puzzles: {puzzleScore}/300
                  </div>
                </div>
              </div>
              
              <button
                onClick={handleMilestoneContinue}
                className="px-12 py-4 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-all duration-300 text-lg font-light tracking-wide"
              >
                Continue
              </button>
            </div>
          </div>
        );
      }

      // Complete Screen
      if (screen === 'complete') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 flex items-center justify-center p-6">
            <div className="text-center space-y-8 max-w-2xl">
              <div className="flex justify-center">
                <Trophy className="w-32 h-32 text-yellow-400 animate-pulse" />
              </div>
              
              <div>
                <h2 className="text-5xl font-extralight text-white tracking-wider mb-4">
                  CONGRATULATIONS
                </h2>
                <p className="text-3xl font-light text-yellow-400 mb-8">
                  You are now officially:
                </p>
                <p className="text-4xl font-bold text-white mb-8">
                  {currentTitle || "ONE MOVE Master"}
                </p>
                <p className="text-slate-400 text-sm mb-4">
                  Only 3% of players reach this point.
                </p>
              </div>
              
              <div className="bg-slate-800/50 rounded-xl p-8 border border-yellow-400/30 space-y-6">
                <div>
                  <p className="text-white text-lg font-light mb-4 leading-relaxed">
                    <span className="text-yellow-400 font-semibold">The Truth:</span><br/>
                    Every puzzle had one answer. But the real test wasn't finding itâ€”it was believing you could, even when it seemed impossible. You proved you have what 97% of people lack: The ability to persist when there's no guarantee of reward.
                  </p>
                </div>
                
                <div className="space-y-3 pt-4 border-t border-slate-700">
                  <div className="text-slate-400 text-sm">Your Achievement Code:</div>
                  <div className="text-2xl font-mono text-yellow-400 tracking-wider bg-slate-900/50 py-3 px-4 rounded">
                    {uniqueCode}
                  </div>
                  <div className="text-slate-400 text-xs">
                    Share this code to prove your mastery
                  </div>
                </div>
                
                <div className="pt-4 border-t border-slate-700">
                  <div className="text-slate-400 text-sm mb-3">Final Stats:</div>
                  <div className="grid grid-cols-2 gap-4 text-white">
                    <div>
                      <div className="text-3xl font-light">{triviaScore}</div>
                      <div className="text-xs text-slate-400">Trivia Correct</div>
                    </div>
                    <div>
                      <div className="text-3xl font-light">{puzzleScore}</div>
                      <div className="text-xs text-slate-400">Puzzles Solved</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <button
                onClick={() => {
                  localStorage.removeItem('oneMoveSave');
                  setScreen('home');
                  setPuzzles([]);
                  setCurrentPuzzleIndex(0);
                  setTriviaScore(0);
                  setPuzzleScore(0);
                  setCurrentTitle("");
                }}
                className="px-12 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 text-lg font-light tracking-wide"
              >
                Play Again
              </button>
            </div>
          </div>
        );
      }

      return null;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<OneMove />);
  </script>
</body>
</html>
